{#
    조직 관리 탭 - 법인설정 페이지 내 조직 트리 관리
    기존 organization.html에서 분리된 컨텐츠
#}

{% macro render_tree_node(org) %}
<div class="tree-node" data-id="{{ org.id }}" data-type="{{ org.org_type }}">
    <div class="tree-node-content" data-action="select-org" data-org-id="{{ org.id }}">
        {% if org.children and org.children|length > 0 %}
        <span class="tree-toggle" data-action="toggle-node">
            <i class="fas fa-chevron-right"></i>
        </span>
        {% else %}
        <span class="tree-toggle-placeholder"></span>
        {% endif %}
        <span class="tree-icon">
            {% if org.org_type == 'company' %}
            <i class="fas fa-building"></i>
            {% elif org.org_type == 'division' %}
            <i class="fas fa-layer-group"></i>
            {% elif org.org_type == 'department' %}
            <i class="fas fa-users"></i>
            {% elif org.org_type == 'team' %}
            <i class="fas fa-user-friends"></i>
            {% else %}
            <i class="fas fa-folder"></i>
            {% endif %}
        </span>
        <span class="tree-label">{{ org.name }}</span>
        {% if org.code %}
        <span class="tree-code">{{ org.code }}</span>
        {% endif %}
    </div>
    {% if org.children and org.children|length > 0 %}
    <div class="tree-children">
        {% for child in org.children %}
            {{ render_tree_node(child) }}
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endmacro %}

<div id="org-management-content">
    <!-- 통계 카드 -->
    <div class="stats-row" id="org-stats-row">
        <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-building"></i></div>
            <div class="stat-content">
                <div class="stat-value" id="stat-total">0</div>
                <div class="stat-label">전체 조직</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-city"></i></div>
            <div class="stat-content">
                <div class="stat-value" id="stat-company">0</div>
                <div class="stat-label">회사</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-layer-group"></i></div>
            <div class="stat-content">
                <div class="stat-value" id="stat-division">0</div>
                <div class="stat-label">본부</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-users"></i></div>
            <div class="stat-content">
                <div class="stat-value" id="stat-department">0</div>
                <div class="stat-label">부서</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-user-friends"></i></div>
            <div class="stat-content">
                <div class="stat-value" id="stat-team">0</div>
                <div class="stat-label">팀</div>
            </div>
        </div>
    </div>

    <!-- 조직 트리 & 상세 정보 -->
    <div class="org-container">
        <!-- 조직 트리 -->
        <div class="org-tree-panel">
            <div class="panel-header">
                <h3><i class="fas fa-folder-tree"></i> 조직 구조</h3>
                <div class="panel-actions">
                    <button class="btn btn-primary btn-sm" data-action="add-org">
                        <i class="fas fa-plus"></i>
                        조직 추가
                    </button>
                    <button class="btn btn-icon" data-action="expand-all" title="전체 펼치기">
                        <i class="fas fa-expand-alt"></i>
                    </button>
                    <button class="btn btn-icon" data-action="collapse-all" title="전체 접기">
                        <i class="fas fa-compress-alt"></i>
                    </button>
                </div>
            </div>
            <div class="panel-body">
                <div class="org-tree" id="orgTree">
                    <div class="empty-tree">
                        <i class="fas fa-folder-open"></i>
                        <p>조직 데이터를 로드 중입니다...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 조직 상세 정보 -->
        <div class="org-detail-panel" id="orgDetailPanel">
            <div class="panel-header">
                <h3><i class="fas fa-info-circle"></i> 조직 정보</h3>
            </div>
            <div class="panel-body">
                <div class="empty-detail">
                    <i class="fas fa-hand-pointer"></i>
                    <p>조직을 선택하세요</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 조직 추가/수정 모달 -->
<div class="modal" id="orgModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="orgModalTitle" class="modal-title">조직 추가</h3>
            <button class="modal-close" data-action="close-org-modal">&times;</button>
        </div>
        <form id="orgForm" data-action="save-org">
            <div class="modal-body">
                <input type="hidden" id="orgId" name="id">

                <div class="form-group">
                    <label for="orgName" class="form-label required">조직명</label>
                    <input type="text" id="orgName" name="name" class="form-input" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="orgCode" class="form-label">조직 코드</label>
                        <input type="text" id="orgCode" name="code" class="form-input"
                               placeholder="예: DEV, HR, SALES">
                    </div>
                    <div class="form-group">
                        <label for="orgType" class="form-label required">조직 유형</label>
                        <select id="orgType" name="org_type" class="form-select" required>
                            <option value="company">회사</option>
                            <option value="division">본부</option>
                            <option value="department" selected>부서</option>
                            <option value="team">팀</option>
                            <option value="unit">파트</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="orgParent" class="form-label">상위 조직</label>
                    <select id="orgParent" name="parent_id" class="form-select">
                        <option value="">없음 (최상위)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="orgDescription" class="form-label">설명</label>
                    <textarea id="orgDescription" name="description" class="form-textarea" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-action="close-org-modal">취소</button>
                <button type="submit" class="btn btn-primary">저장</button>
            </div>
        </form>
    </div>
</div>

<!-- 삭제 확인 모달 -->
<div class="modal" id="deleteModal">
    <div class="modal-content modal-sm">
        <div class="modal-header">
            <h3 class="modal-title">조직 삭제</h3>
            <button class="modal-close" data-action="close-delete-modal">&times;</button>
        </div>
        <div class="modal-body">
            <p id="deleteMessage">이 조직을 삭제하시겠습니까?</p>
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="cascadeDelete">
                    <span>하위 조직도 함께 삭제</span>
                </label>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-action="close-delete-modal">취소</button>
            <button type="button" class="btn btn-danger" data-action="confirm-delete">삭제</button>
        </div>
    </div>
</div>
