{#
    직원 폼 - 급여정보 섹션
    employee: 직원 객체 (수정 모드일 때)
    salary: 급여 정보 객체
    has_person_contract: 승인된 개인계약 존재 여부 (계약 후 수정 불가용)

    Migration (2026-01-13): .card → .info-section
#}
{% from 'shared/macros/_info_display.html' import info_section_start, info_section_end, info_section_header_with_action, info_section_body_start, info_section_body_end, svg_icon_currency %}

{# 계약 후 수정 불가 플래그: 승인된 개인계약이 있을 때 #}
{% set is_contract_readonly = has_person_contract %}

<section class="form__section" id="salary-info">
    {{ info_section_start() }}
        <div class="info-section__header">
            <div class="info-section__title">
                <div class="info-section__icon">
                    {{ svg_icon_currency() }}
                </div>
                급여정보{% if is_contract_readonly %} <small class="text-muted">(계약 확정)</small>{% endif %}
            </div>
            {% if not is_contract_readonly %}
            <div class="info-section__actions">
                <button type="button" class="btn btn--outline-primary btn--sm" id="openSalaryCalculatorBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="16" height="16">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                    </svg>
                    포괄임금 계산기
                </button>
            </div>
            {% endif %}
        </div>
        {{ info_section_body_start() }}
            <!-- 포괄임금제 요약 (계산기 사용 시 표시) -->
            <div class="comprehensive-salary-summary hidden" id="comprehensiveSalarySummary">
                <div class="summary-header">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="16" height="16">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span>포괄임금제 적용</span>
                </div>
                <div class="summary-content">
                    <div class="summary-item">
                        <span class="label">연봉</span>
                        <span class="value" id="summaryAnnualSalary">-</span>
                    </div>
                    <div class="summary-item">
                        <span class="label">통상임금(시급)</span>
                        <span class="value" id="summaryHourlyWage">-</span>
                    </div>
                    <div class="summary-item">
                        <span class="label">연장근로</span>
                        <span class="value" id="summaryOvertimeHours">-</span>
                    </div>
                </div>
            </div>

            <div class="form-grid">
                <div class="form__group">
                    <label for="base_salary" class="form__label">기본급</label>
                    <input type="number" id="base_salary" name="base_salary" class="form__input{% if is_contract_readonly %} readonly-field{% endif %}"
                           value="{{ salary.base_salary if salary and salary.base_salary else '' }}"
                           placeholder="3000000"
                           {% if is_contract_readonly %}readonly disabled{% endif %}>
                    {% if not is_contract_readonly %}<small class="form__hint">월 기본급 (원)</small>{% endif %}
                </div>

                <div class="form__group">
                    <label for="position_allowance" class="form__label">직책수당</label>
                    <input type="number" id="position_allowance" name="position_allowance" class="form__input{% if is_contract_readonly %} readonly-field{% endif %}"
                           value="{{ salary.position_allowance if salary and salary.position_allowance else '' }}"
                           placeholder="200000"
                           {% if is_contract_readonly %}readonly disabled{% endif %}>
                </div>

                <div class="form__group">
                    <label for="meal_allowance" class="form__label">식대</label>
                    <input type="number" id="meal_allowance" name="meal_allowance" class="form__input{% if is_contract_readonly %} readonly-field{% endif %}"
                           value="{{ salary.meal_allowance if salary and salary.meal_allowance else '' }}"
                           placeholder="100000"
                           {% if is_contract_readonly %}readonly disabled{% endif %}>
                </div>

                <div class="form__group">
                    <label for="transportation_allowance" class="form__label">교통비</label>
                    <input type="number" id="transportation_allowance" name="transportation_allowance" class="form__input{% if is_contract_readonly %} readonly-field{% endif %}"
                           value="{{ salary.transportation_allowance if salary and salary.transportation_allowance else '' }}"
                           placeholder="100000"
                           {% if is_contract_readonly %}readonly disabled{% endif %}>
                </div>

                <div class="form__group">
                    <label for="bonus_rate" class="form__label">상여금률 (%)</label>
                    <input type="number" id="bonus_rate" name="bonus_rate" class="form__input{% if is_contract_readonly %} readonly-field{% endif %}"
                           value="{{ salary.bonus_rate if salary and salary.bonus_rate else '' }}"
                           placeholder="200" step="1" min="0" max="1000"
                           {% if is_contract_readonly %}readonly disabled{% endif %}>
                </div>

                <div class="form__group">
                    <label for="salary_type" class="form__label">급여 지급방식</label>
                    <select id="salary_type" name="salary_type" class="form__select{% if is_contract_readonly %} readonly-field{% endif %}"
                            {% if is_contract_readonly %}disabled{% endif %}>
                        <option value="">선택하세요</option>
                        <option value="monthly" {% if salary and salary.salary_type == 'monthly' %}selected{% endif %}>월급</option>
                        <option value="hourly" {% if salary and salary.salary_type == 'hourly' %}selected{% endif %}>시급</option>
                        <option value="daily" {% if salary and salary.salary_type == 'daily' %}selected{% endif %}>일급</option>
                        <option value="annual" {% if salary and salary.salary_type == 'annual' %}selected{% endif %}>연봉</option>
                    </select>
                </div>

                {# Phase 28: 은행명, 계좌번호는 기본정보 섹션(_personal_info.html)에서 관리 #}
            </div>

            <!-- 포괄임금제 상세 필드 (확장 영역) -->
            <div class="comprehensive-salary-details hidden" id="comprehensiveSalaryDetails">
                <h3 class="section-subtitle">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="20" height="20">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                    </svg>
                    포괄임금제 수당 내역
                </h3>
                <div class="form-grid">
                    <div class="form__group">
                        <label for="annual_salary" class="form__label">연봉</label>
                        <input type="number" id="annual_salary" name="annual_salary" class="form__input"
                               value="{{ salary.annual_salary if salary and salary.annual_salary else '' }}"
                               placeholder="52000000" readonly>
                    </div>
                    <div class="form__group">
                        <label for="hourly_wage" class="form__label">통상임금(시급)</label>
                        <input type="number" id="hourly_wage" name="hourly_wage" class="form__input"
                               value="{{ salary.hourly_wage if salary and salary.hourly_wage else '' }}"
                               placeholder="20733" readonly>
                    </div>
                    <div class="form__group">
                        <label for="overtime_hours" class="form__label">연장근로시간(월)</label>
                        <input type="number" id="overtime_hours" name="overtime_hours" class="form__input"
                               value="{{ salary.overtime_hours if salary and salary.overtime_hours else '' }}"
                               placeholder="24" readonly>
                    </div>
                    <div class="form__group">
                        <label for="overtime_allowance" class="form__label">연장근로수당</label>
                        <input type="number" id="overtime_allowance" name="overtime_allowance" class="form__input"
                               value="{{ salary.overtime_allowance if salary and salary.overtime_allowance else '' }}"
                               placeholder="746388" readonly>
                    </div>
                    <div class="form__group">
                        <label for="night_hours" class="form__label">야간근로시간(월)</label>
                        <input type="number" id="night_hours" name="night_hours" class="form__input"
                               value="{{ salary.night_hours if salary and salary.night_hours else '' }}"
                               placeholder="8" readonly>
                    </div>
                    <div class="form__group">
                        <label for="night_allowance" class="form__label">야간근로수당</label>
                        <input type="number" id="night_allowance" name="night_allowance" class="form__input"
                               value="{{ salary.night_allowance if salary and salary.night_allowance else '' }}"
                               placeholder="82932" readonly>
                    </div>
                    <div class="form__group">
                        <label for="holiday_days" class="form__label">휴일근로일수(월)</label>
                        <input type="number" id="holiday_days" name="holiday_days" class="form__input"
                               value="{{ salary.holiday_days if salary and salary.holiday_days else '' }}"
                               placeholder="1" readonly>
                    </div>
                    <div class="form__group">
                        <label for="holiday_allowance" class="form__label">휴일근로수당</label>
                        <input type="number" id="holiday_allowance" name="holiday_allowance" class="form__input"
                               value="{{ salary.holiday_allowance if salary and salary.holiday_allowance else '' }}"
                               placeholder="248796" readonly>
                    </div>
                </div>
            </div>
        {{ info_section_body_end() }}
    {{ info_section_end() }}
</section>

<!-- 급여 계산기 모달 Include -->
{% include 'shared/partials/_salary_calculator_modal.html' %}
