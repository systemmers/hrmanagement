{#
    직원 폼 - 소속정보 섹션
    employee: 직원 객체 (수정 모드일 때)
    has_person_contract: 승인된 개인계약 존재 여부 (계약 후 수정 불가용)

    Migration (2026-01-13): .card → .info-section
#}
{% from 'shared/macros/_info_display.html' import info_section_start, info_section_end, info_section_header, info_section_body_start, info_section_body_end, svg_icon_building %}

{# 계약 후 수정 불가 플래그: 승인된 개인계약이 있을 때 #}
{% set is_contract_readonly = has_person_contract %}

<section class="form__section" id="organization-info">
    {{ info_section_start() }}
        {{ info_section_header('소속정보' ~ (' (계약 확정)' if is_contract_readonly else ''), svg_icon_building()) }}
        {{ info_section_body_start() }}
            <div class="form-grid">
                <div class="form__group">
                    <label for="employee_number" class="form__label">사번</label>
                    {% if employee and employee.employee_number %}
                    <input type="text" id="employee_number" name="employee_number" class="form__input{% if is_contract_readonly %} readonly-field{% endif %}"
                           value="{{ employee.employee_number }}" readonly
                           {% if is_contract_readonly %}disabled{% endif %}>
                    {% else %}
                    <input type="text" id="employee_number" name="employee_number" class="form__input"
                           value="" placeholder="자동생성" readonly>
                    <small class="form__hint">등록 시 자동으로 생성됩니다. (형식: EMP-YYYY-NNNN)</small>
                    {% endif %}
                </div>

                <div class="form__group">
                    <label for="organization_display" class="form__label">소속 조직 {% if not is_contract_readonly %}<span class="required">*</span>{% endif %}</label>
                    <input type="text" id="organization_display" class="form__input org-selector-input{% if is_contract_readonly %} readonly-field{% endif %}"
                           value="{{ employee.organization.name if employee and employee.organization else '' }}"
                           placeholder="조직을 선택하세요" readonly
                           {% if is_contract_readonly %}disabled{% endif %}>
                    <input type="hidden" id="organization_id" name="organization_id"
                           value="{{ employee.organization_id if employee and employee.organization_id else '' }}"
                           {% if is_contract_readonly %}disabled{% endif %}>
                    {% if not is_contract_readonly %}<small class="form__hint">클릭하여 조직 트리에서 선택하세요</small>{% endif %}
                </div>

                <div class="form__group">
                    <label for="department" class="form__label">부서명</label>
                    <input type="text" id="department" name="department" class="form__input{% if is_contract_readonly %} readonly-field{% endif %}"
                           value="{{ employee.department if employee else '' }}"
                           placeholder="개발팀"
                           {% if is_contract_readonly %}readonly disabled{% endif %}>
                    {% if not is_contract_readonly %}<small class="form__hint">조직 선택과 별도로 입력할 수 있습니다</small>{% endif %}
                </div>

                <div class="form__group">
                    <label for="team" class="form__label">팀</label>
                    <input type="text" id="team" name="team" class="form__input{% if is_contract_readonly %} readonly-field{% endif %}"
                           value="{{ employee.team if employee and employee.team else '' }}"
                           placeholder="프론트엔드팀"
                           {% if is_contract_readonly %}readonly disabled{% endif %}>
                </div>

                <div class="form__group">
                    <label for="position" class="form__label">직위 {% if not is_contract_readonly %}<span class="required">*</span>{% endif %}</label>
                    <select id="position" name="position" class="form__select{% if is_contract_readonly %} readonly-field{% endif %}"
                            {% if not is_contract_readonly %}required{% endif %}
                            {% if is_contract_readonly %}disabled{% endif %}>
                        <option value="">선택하세요</option>
                        {% if classification_options and classification_options.positions %}
                            {% for pos in classification_options.positions %}
                            <option value="{{ pos.value }}" {% if employee and employee.position == pos.value %}selected{% endif %}>{{ pos.label }}</option>
                            {% endfor %}
                        {% else %}
                            {% for pos in ['인턴', '사원', '주임', '대리', '과장', '차장', '부장', '이사', '상무', '전무', '대표'] %}
                            <option value="{{ pos }}" {% if employee and employee.position == pos %}selected{% endif %}>{{ pos }}</option>
                            {% endfor %}
                        {% endif %}
                    </select>
                    {% if not is_contract_readonly %}<small class="form__hint">서열 기준 (사원, 대리, 과장, 부장...)</small>{% endif %}
                </div>

                <div class="form__group">
                    <label for="job_grade" class="form__label">직급</label>
                    <input type="text" id="job_grade" name="job_grade" class="form__input{% if is_contract_readonly %} readonly-field{% endif %}"
                           value="{{ employee.job_grade if employee and employee.job_grade else '' }}"
                           placeholder="L3, Senior, 2호봉"
                           {% if is_contract_readonly %}readonly disabled{% endif %}>
                    {% if not is_contract_readonly %}<small class="form__hint">역량 레벨 (L3, Senior, 2호봉...)</small>{% endif %}
                </div>

                <div class="form__group">
                    <label for="job_title" class="form__label">직책</label>
                    <select id="job_title" name="job_title" class="form__select{% if is_contract_readonly %} readonly-field{% endif %}"
                            {% if is_contract_readonly %}disabled{% endif %}>
                        <option value="">선택하세요</option>
                        {% if classification_options and classification_options.job_titles %}
                            {% for jt in classification_options.job_titles %}
                            <option value="{{ jt.value }}" {% if employee and employee.job_title == jt.value %}selected{% endif %}>{{ jt.label }}</option>
                            {% endfor %}
                        {% endif %}
                    </select>
                    {% if not is_contract_readonly %}<small class="form__hint">책임자 역할 (팀장, 본부장, CFO...)</small>{% endif %}
                </div>

                <div class="form__group">
                    <label for="job_role" class="form__label">직무</label>
                    <input type="text" id="job_role" name="job_role" class="form__input{% if is_contract_readonly %} readonly-field{% endif %}"
                           value="{{ employee.job_role if employee and employee.job_role else '' }}"
                           placeholder="인사기획, 웹개발, 회계관리"
                           {% if is_contract_readonly %}readonly disabled{% endif %}>
                    {% if not is_contract_readonly %}<small class="form__hint">수행 업무 (인사기획, 회계관리...)</small>{% endif %}
                </div>

                <div class="form__group">
                    <label for="work_location" class="form__label">근무지</label>
                    <input type="text" id="work_location" name="work_location" class="form__input{% if is_contract_readonly %} readonly-field{% endif %}"
                           value="{{ employee.work_location if employee and employee.work_location else '' }}"
                           placeholder="본사, 지사 등"
                           {% if is_contract_readonly %}readonly disabled{% endif %}>
                </div>

                <div class="form__group">
                    <label for="internal_phone" class="form__label">내선번호</label>
                    <input type="text" id="internal_phone" name="internal_phone" class="form__input{% if is_contract_readonly %} readonly-field{% endif %}"
                           value="{{ employee.internal_phone if employee and employee.internal_phone else '' }}"
                           placeholder="1234"
                           {% if is_contract_readonly %}readonly disabled{% endif %}>
                </div>

                <div class="form__group">
                    <label for="company_email" class="form__label">회사 이메일</label>
                    <input type="email" id="company_email" name="company_email" class="form__input{% if is_contract_readonly %} readonly-field{% endif %}"
                           value="{{ employee.company_email if employee and employee.company_email else '' }}"
                           placeholder="hong@company.co.kr"
                           {% if is_contract_readonly %}readonly disabled{% endif %}>
                </div>
            </div>
        {{ info_section_body_end() }}
    {{ info_section_end() }}
</section>
