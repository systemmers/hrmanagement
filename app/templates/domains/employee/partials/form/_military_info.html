{#
    직원 폼 - 병역정보 섹션
    employee: 직원 객체 (수정 모드일 때)
    has_person_contract: 개인계약 연동 여부 (법인에서 개인정보 수정 제한)
#}
{# 개인정보 읽기 전용 플래그: 법인 계정 + 개인계약 연동 시 #}
{% set is_personal_readonly = is_corporate and has_person_contract %}

{# SSOT: Blueprint에서 military 전달 필수 (N+1 쿼리 방지) #}
{% set mil = military | default({}) %}

<section class="form-section" id="military-info">
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">
                <i class="fas fa-shield-alt"></i>
                병역정보
                {% if is_personal_readonly %}<small class="text-muted">(동기화 전용)</small>{% endif %}
            </h2>
        </div>
        <div class="card-body">
            <div class="form-grid">
                <div class="form-group">
                    <label for="military_status" class="form-label">병역사항</label>
                    <select id="military_status" name="military_status" class="form-select{% if is_personal_readonly %} readonly-field{% endif %}"
                            {% if is_personal_readonly %}disabled{% endif %}>
                        <option value="">선택하세요</option>
                        {% for opt in MILITARY_STATUS_OPTIONS %}
                        <option value="{{ opt.value }}" {% if mil.service_type == opt.value or mil.status == opt.value or (employee and employee.military_status == opt.value) %}selected{% endif %}>{{ opt.label }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="military_branch" class="form-label">군별</label>
                    <select id="military_branch" name="military_branch" class="form-select{% if is_personal_readonly %} readonly-field{% endif %}"
                            {% if is_personal_readonly %}disabled{% endif %}>
                        <option value="">선택하세요</option>
                        {% for opt in MILITARY_BRANCH_OPTIONS %}
                        <option value="{{ opt.value }}" {% if mil.branch == opt.value or (employee and employee.military_branch == opt.value) %}selected{% endif %}>{{ opt.label }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="military_rank" class="form-label">계급</label>
                    <input type="text" id="military_rank" name="military_rank" class="form-input{% if is_personal_readonly %} readonly-field{% endif %}"
                           value="{{ mil.rank if mil.rank else (employee.military_rank if employee and employee.military_rank else '') }}"
                           placeholder="병장, 상병 등"
                           {% if is_personal_readonly %}readonly disabled{% endif %}>
                </div>

                <div class="form-group">
                    <label for="military_period" class="form-label">복무기간</label>
                    <input type="text" id="military_period" name="military_period" class="form-input{% if is_personal_readonly %} readonly-field{% endif %}"
                           value="{{ (mil.start_date ~ ' ~ ' ~ mil.end_date) if mil.start_date and mil.end_date else (employee.military_period if employee and employee.military_period else '') }}"
                           placeholder="2018.01 ~ 2019.10"
                           {% if is_personal_readonly %}readonly disabled{% endif %}>
                </div>

                <div class="form-group">
                    <label for="military_duty" class="form-label">보직</label>
                    <input type="text" id="military_duty" name="military_duty" class="form-input{% if is_personal_readonly %} readonly-field{% endif %}"
                           value="{{ mil.duty if mil.duty else (employee.military_duty if employee and employee.military_duty else '') }}"
                           placeholder="운전병, 행정병 등"
                           {% if is_personal_readonly %}readonly disabled{% endif %}>
                </div>

                <div class="form-group">
                    <label for="military_specialty" class="form-label">병과</label>
                    <input type="text" id="military_specialty" name="military_specialty" class="form-input{% if is_personal_readonly %} readonly-field{% endif %}"
                           value="{{ mil.specialty if mil.specialty else (employee.military_specialty if employee and employee.military_specialty else '') }}"
                           placeholder="보병, 통신, 의무 등"
                           {% if is_personal_readonly %}readonly disabled{% endif %}>
                </div>

                <div class="form-group">
                    <label for="military_exemption_reason" class="form-label">면제사유</label>
                    <input type="text" id="military_exemption_reason" name="military_exemption_reason" class="form-input{% if is_personal_readonly %} readonly-field{% endif %}"
                           value="{{ mil.exemption_reason if mil.exemption_reason else (employee.military_exemption_reason if employee and employee.military_exemption_reason else '') }}"
                           placeholder="병역면제 사유 (해당 시 입력)"
                           {% if is_personal_readonly %}readonly disabled{% endif %}>
                </div>
            </div>
        </div>
    </div>
</section>
