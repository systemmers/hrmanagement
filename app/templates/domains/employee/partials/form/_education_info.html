{#
    직원 폼 - 학력정보 섹션 (동적 폼)
    employee: 직원 객체 (수정 모드일 때)
    has_person_contract: 개인계약 연동 여부 (법인에서 개인정보 수정 제한)
    Phase 5.2: 항목별 증빙 서류 연동 UI 추가

    Migration (2026-01-13): .card → .info-section
#}
{% from "shared/macros/_evidence_attachment.html" import evidence_attachment %}
{% from 'shared/macros/_info_display.html' import info_section_start, info_section_end, info_section_body_start, info_section_body_end, svg_icon_academic %}
{# 개인정보 읽기 전용 플래그: 법인 계정 + 개인계약 연동 시 #}
{% set is_personal_readonly = is_corporate and has_person_contract %}
<section class="form__section" id="education-info">
    {{ info_section_start() }}
        <div class="info-section__header">
            <div class="info-section__title">
                <div class="info-section__icon">
                    {{ svg_icon_academic() }}
                </div>
                학력정보{% if is_personal_readonly %} <small class="text-muted">(동기화 전용)</small>{% endif %}
            </div>
            {% if not is_personal_readonly %}
            <div class="info-section__actions">
                <button type="button" class="info-section__add-btn" id="addEducation">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="16" height="16">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                    추가
                </button>
            </div>
            {% endif %}
        </div>
        {{ info_section_body_start() }}
            <div class="dynamic-list" id="educationList">
                {# SSOT: Blueprint에서 education_list 전달 필수 (N+1 쿼리 방지) #}
                {% set educations = education_list | default([]) %}
                {% if educations and educations|length > 0 %}
                    {% for edu in educations %}
                    <div class="dynamic-item" data-index="{{ loop.index0 }}" data-entity-id="{{ edu.id or '' }}">
                        <input type="hidden" name="education_id[]" value="{{ edu.id or '' }}">
                        <div class="form-grid">
                            <div class="form__group">
                                <label class="form__label">학교명</label>
                                <input type="text" name="education_school_name[]" class="form__input{% if is_personal_readonly %} readonly-field{% endif %}"
                                       value="{{ edu.school_name }}" placeholder="대학교명"
                                       {% if is_personal_readonly %}readonly disabled{% endif %}>
                            </div>
                            <div class="form__group">
                                <label class="form__label">학위</label>
                                <select name="education_degree[]" class="form__select{% if is_personal_readonly %} readonly-field{% endif %}"
                                        {% if is_personal_readonly %}disabled{% endif %}>
                                    <option value="">선택하세요</option>
                                    {% for opt in DEGREE_OPTIONS %}
                                    <option value="{{ opt.value }}" {% if edu.degree == opt.value %}selected{% endif %}>{{ opt.label }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="form__group">
                                <label class="form__label">전공</label>
                                <input type="text" name="education_major[]" class="form__input{% if is_personal_readonly %} readonly-field{% endif %}"
                                       value="{{ edu.major }}" placeholder="전공명"
                                       {% if is_personal_readonly %}readonly disabled{% endif %}>
                            </div>
                            <div class="form__group">
                                <label class="form__label">졸업년도</label>
                                <input type="text" name="education_graduation_year[]" class="form__input{% if is_personal_readonly %} readonly-field{% endif %}"
                                       value="{{ edu.graduation_year }}" placeholder="2020"
                                       {% if is_personal_readonly %}readonly disabled{% endif %}>
                            </div>
                            <div class="form__group">
                                <label class="form__label">학점</label>
                                <input type="text" name="education_gpa[]" class="form__input{% if is_personal_readonly %} readonly-field{% endif %}"
                                       value="{{ edu.gpa if edu.gpa else '' }}" placeholder="4.0/4.5"
                                       {% if is_personal_readonly %}readonly disabled{% endif %}>
                            </div>
                            <div class="form__group">
                                <label class="form__label">졸업유무</label>
                                <select name="education_graduation_status[]" class="form__select{% if is_personal_readonly %} readonly-field{% endif %}"
                                        {% if is_personal_readonly %}disabled{% endif %}>
                                    <option value="">선택하세요</option>
                                    {% for opt in GRADUATION_STATUS_OPTIONS %}
                                    <option value="{{ opt.value }}" {% if edu.graduation_status == opt.value or edu.status == opt.value %}selected{% endif %}>{{ opt.label }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="form__group">
                                <label class="form__label">비고</label>
                                <input type="text" name="education_note[]" class="form__input{% if is_personal_readonly %} readonly-field{% endif %}"
                                       value="{{ edu.note }}" placeholder="비고"
                                       {% if is_personal_readonly %}readonly disabled{% endif %}>
                            </div>
                        </div>
                        {% if not is_personal_readonly %}
                        <button type="button" class="btn-remove" title="삭제">
                            <i class="fas fa-times"></i>
                        </button>
                        {% endif %}
                        {# Phase 5.2: 증빙 서류 첨부 영역 #}
                        {% if edu.id %}
                        {{ evidence_attachment('education', edu.id, owner_type='employee', owner_id=employee.id if employee else None, readonly=is_personal_readonly) }}
                        {% endif %}
                    </div>
                    {% endfor %}
                {% else %}
                <div class="dynamic-item" data-index="0">
                    <div class="form-grid">
                        <div class="form__group">
                            <label class="form__label">학교명</label>
                            <input type="text" name="education_school_name[]" class="form__input{% if is_personal_readonly %} readonly-field{% endif %}" placeholder="대학교명"
                                   {% if is_personal_readonly %}readonly disabled{% endif %}>
                        </div>
                        <div class="form__group">
                            <label class="form__label">학위</label>
                            <select name="education_degree[]" class="form__select{% if is_personal_readonly %} readonly-field{% endif %}"
                                    {% if is_personal_readonly %}disabled{% endif %}>
                                <option value="">선택하세요</option>
                                {% for opt in DEGREE_OPTIONS %}
                                <option value="{{ opt.value }}">{{ opt.label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form__group">
                            <label class="form__label">전공</label>
                            <input type="text" name="education_major[]" class="form__input{% if is_personal_readonly %} readonly-field{% endif %}" placeholder="전공명"
                                   {% if is_personal_readonly %}readonly disabled{% endif %}>
                        </div>
                        <div class="form__group">
                            <label class="form__label">졸업년도</label>
                            <input type="text" name="education_graduation_year[]" class="form__input{% if is_personal_readonly %} readonly-field{% endif %}" placeholder="2020"
                                   {% if is_personal_readonly %}readonly disabled{% endif %}>
                        </div>
                        <div class="form__group">
                            <label class="form__label">학점</label>
                            <input type="text" name="education_gpa[]" class="form__input{% if is_personal_readonly %} readonly-field{% endif %}" placeholder="4.0/4.5"
                                   {% if is_personal_readonly %}readonly disabled{% endif %}>
                        </div>
                        <div class="form__group">
                            <label class="form__label">졸업유무</label>
                            <select name="education_graduation_status[]" class="form__select{% if is_personal_readonly %} readonly-field{% endif %}"
                                    {% if is_personal_readonly %}disabled{% endif %}>
                                <option value="">선택하세요</option>
                                {% for opt in GRADUATION_STATUS_OPTIONS %}
                                <option value="{{ opt.value }}">{{ opt.label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form__group">
                            <label class="form__label">비고</label>
                            <input type="text" name="education_note[]" class="form__input{% if is_personal_readonly %} readonly-field{% endif %}" placeholder="비고"
                                   {% if is_personal_readonly %}readonly disabled{% endif %}>
                        </div>
                    </div>
                    {% if not is_personal_readonly %}
                    <button type="button" class="btn-remove" title="삭제">
                        <i class="fas fa-times"></i>
                    </button>
                    {% endif %}
                </div>
                {% endif %}
            </div>
            <p class="form__hint">최종학력부터 역순으로 입력해 주세요.</p>
        {{ info_section_body_end() }}
    {{ info_section_end() }}
</section>
