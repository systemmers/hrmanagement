{#
    직원 폼 - 프로젝트 참여이력 섹션 (동적 폼)
    과거 경력에서 참여했던 프로젝트/사업 이력
    employee: 직원 객체 (수정 모드일 때)
    project_participation_list: 프로젝트 참여이력 목록
    has_person_contract: 개인계약 연동 여부 (법인에서 개인정보 수정 제한)
#}
{# 개인정보 읽기 전용 플래그: 법인 계정 + 개인계약 연동 시 #}
{% set is_personal_readonly = is_corporate and has_person_contract %}
<section class="form__section" id="project-participation-info">
    <div class="card">
        <div class="card__header">
            <h2 class="card__title">
                <i class="fas fa-briefcase"></i>
                프로젝트 참여이력
                {% if is_personal_readonly %}<small class="text-muted">(동기화 전용)</small>{% endif %}
            </h2>
            {% if not is_personal_readonly %}
            <button type="button" class="btn btn--sm btn--secondary" id="addProjectParticipation">
                <i class="fas fa-plus"></i> 추가
            </button>
            {% endif %}
        </div>
        <div class="card__body">
            <div class="dynamic-list" id="projectParticipationList">
                {# project_participation_list 우선 사용, 없으면 employee.project_participations 사용 #}
                {# list()로 변환하여 빈 리스트 체크가 정확히 작동하도록 함 #}
                {% set participations = project_participation_list if project_participation_list is defined else (list(employee.project_participations) if employee and employee.project_participations else []) %}
                {% if participations and participations|length > 0 %}
                    {% for participation in participations %}
                    <div class="dynamic-item" data-index="{{ loop.index0 }}">
                        <div class="form-grid">
                            <div class="form__group">
                                <label class="form__label">사업명</label>
                                <input type="text" name="participation_project_name[]" class="form__input{% if is_personal_readonly %} readonly-field{% endif %}"
                                       value="{{ participation.project_name }}"
                                       placeholder="프로젝트/사업명"
                                       {% if is_personal_readonly %}readonly disabled{% endif %}>
                            </div>
                            <div class="form__group">
                                <label class="form__label">역할/직책</label>
                                <input type="text" name="participation_role[]" class="form__input{% if is_personal_readonly %} readonly-field{% endif %}"
                                       value="{{ participation.role }}"
                                       placeholder="PM, 개발자, 디자이너 등"
                                       {% if is_personal_readonly %}readonly disabled{% endif %}>
                            </div>
                            <div class="form__group">
                                <label class="form__label">시작일</label>
                                <input type="date" name="participation_start_date[]" class="form__input{% if is_personal_readonly %} readonly-field{% endif %}"
                                       value="{{ participation.start_date }}"
                                       {% if is_personal_readonly %}readonly disabled{% endif %}>
                            </div>
                            <div class="form__group">
                                <label class="form__label">종료일</label>
                                <input type="date" name="participation_end_date[]" class="form__input{% if is_personal_readonly %} readonly-field{% endif %}"
                                       value="{{ participation.end_date }}"
                                       {% if is_personal_readonly %}readonly disabled{% endif %}>
                            </div>
                            <div class="form__group">
                                <label class="form__label">담당업무</label>
                                <input type="text" name="participation_duty[]" class="form__input{% if is_personal_readonly %} readonly-field{% endif %}"
                                       value="{{ participation.duty }}"
                                       placeholder="담당업무"
                                       {% if is_personal_readonly %}readonly disabled{% endif %}>
                            </div>
                            <div class="form__group">
                                <label class="form__label">발주처</label>
                                <input type="text" name="participation_client[]" class="form__input{% if is_personal_readonly %} readonly-field{% endif %}"
                                       value="{{ participation.client }}"
                                       placeholder="발주처/클라이언트"
                                       {% if is_personal_readonly %}readonly disabled{% endif %}>
                            </div>
                        </div>
                        {% if not is_personal_readonly %}
                        <button type="button" class="btn-remove" title="삭제">
                            <i class="fas fa-times"></i>
                        </button>
                        {% endif %}
                    </div>
                    {% endfor %}
                {% else %}
                <div class="dynamic-item" data-index="0">
                    <div class="form-grid">
                        <div class="form__group">
                            <label class="form__label">사업명</label>
                            <input type="text" name="participation_project_name[]" class="form__input{% if is_personal_readonly %} readonly-field{% endif %}" placeholder="프로젝트/사업명"
                                   {% if is_personal_readonly %}readonly disabled{% endif %}>
                        </div>
                        <div class="form__group">
                            <label class="form__label">역할/직책</label>
                            <input type="text" name="participation_role[]" class="form__input{% if is_personal_readonly %} readonly-field{% endif %}" placeholder="PM, 개발자, 디자이너 등"
                                   {% if is_personal_readonly %}readonly disabled{% endif %}>
                        </div>
                        <div class="form__group">
                            <label class="form__label">시작일</label>
                            <input type="date" name="participation_start_date[]" class="form__input{% if is_personal_readonly %} readonly-field{% endif %}"
                                   {% if is_personal_readonly %}readonly disabled{% endif %}>
                        </div>
                        <div class="form__group">
                            <label class="form__label">종료일</label>
                            <input type="date" name="participation_end_date[]" class="form__input{% if is_personal_readonly %} readonly-field{% endif %}"
                                   {% if is_personal_readonly %}readonly disabled{% endif %}>
                        </div>
                        <div class="form__group">
                            <label class="form__label">담당업무</label>
                            <input type="text" name="participation_duty[]" class="form__input{% if is_personal_readonly %} readonly-field{% endif %}" placeholder="담당업무"
                                   {% if is_personal_readonly %}readonly disabled{% endif %}>
                        </div>
                        <div class="form__group">
                            <label class="form__label">발주처</label>
                            <input type="text" name="participation_client[]" class="form__input{% if is_personal_readonly %} readonly-field{% endif %}" placeholder="발주처/클라이언트"
                                   {% if is_personal_readonly %}readonly disabled{% endif %}>
                        </div>
                    </div>
                    {% if not is_personal_readonly %}
                    <button type="button" class="btn-remove" title="삭제">
                        <i class="fas fa-times"></i>
                    </button>
                    {% endif %}
                </div>
                {% endif %}
            </div>
            <p class="form__hint">과거 경력에서 참여했던 프로젝트/사업 이력을 입력해 주세요.</p>
        </div>
    </div>
</section>
