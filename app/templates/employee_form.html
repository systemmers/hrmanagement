{% extends "base.html" %}

{% block title %}{% if employee %}직원 수정{% else %}직원 등록{% endif %} - 인사카드 관리 시스템{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/layouts/section-nav.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/cards.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/employee-form.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/layouts/right-sidebar.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/tree-selector.css') }}">
{% endblock %}

{% block content %}
<div class="form-page-layout-with-sidebar">
    {# 좌측: 섹션 네비게이션 #}
    {% include 'partials/employee_form/_section_nav.html' %}

    {# 메인 콘텐츠: 폼 #}
    <main class="form-main-content">
        {# 페이지 헤더 #}
        <div class="form-page-header">
            <h1 class="form-page-title">{% if employee %}직원 정보 수정{% else %}신규 직원 등록{% endif %}</h1>
            <div class="form-page-actions">
                <a href="{% if employee %}{{ url_for('employees.employee_detail', employee_id=employee.id) }}{% else %}{{ url_for('main.index') }}{% endif %}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i>
                    <span>취소</span>
                </a>
            </div>
        </div>

        <form method="POST" action="{% if employee %}{{ url_for('employees.employee_update', employee_id=employee.id) }}{% else %}{{ url_for('employees.employee_create') }}{% endif %}" class="employee-form" id="employeeForm">

            {# 섹션 1: 개인 기본정보 #}
            {% include 'partials/employee_form/_personal_info.html' %}

            {# 섹션 2: 소속정보 #}
            {% include 'partials/employee_form/_organization_info.html' %}

            {# 섹션 3: 계약정보 #}
            {% include 'partials/employee_form/_contract_info.html' %}

            {# 섹션 4: 학력정보 (동적 폼) #}
            {% include 'partials/employee_form/_education_info.html' %}

            {# 섹션 5: 경력정보 (동적 폼) #}
            {% include 'partials/employee_form/_career_info.html' %}

            {# 섹션 6: 자격증 (동적 폼) #}
            {% include 'partials/employee_form/_certificate_info.html' %}

            {# 섹션 7: 언어능력 (동적 폼) #}
            {% include 'partials/employee_form/_language_info.html' %}

            {# 섹션 8: 프로젝트 (동적 폼) #}
            {% include 'partials/employee_form/_project_info.html' %}

            {# 섹션 9: 병역정보 #}
            {% include 'partials/employee_form/_military_info.html' %}

            {# 섹션 10: 가족사항 (동적 폼) #}
            {% include 'partials/employee_form/_family_info.html' %}

            {# 섹션 11: 급여정보 #}
            {% include 'partials/employee_form/_salary_info.html' %}

            {# 섹션 12: 4대보험 #}
            {% include 'partials/employee_form/_insurance_info.html' %}

            {# 폼 제출 버튼 #}
            {% include 'partials/employee_form/_submit_section.html' %}

        </form>
    </main>

    {% include 'partials/_attachment_sidebar.html' %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/components/tree-selector.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='js/pages/employee-form.js') }}"></script>
<script>
    // 조직 트리 선택기 초기화
    document.addEventListener('DOMContentLoaded', function() {
        new TreeSelector({
            inputId: 'organization_display',
            hiddenInputId: 'organization_id',
            modalId: 'orgTreeSelectorModal',
            apiUrl: '/admin/api/organizations?format=tree',
            allowEmpty: true,
            onSelect: function(selected) {
                if (selected) {
                    console.log('Selected organization:', selected);
                }
            }
        });
    });
</script>
{% endblock %}
