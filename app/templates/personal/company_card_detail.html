{% extends "base.html" %}

{% block title %}{{ company.name }} 인사카드 - 인사카드 관리 시스템{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/layouts/section-nav.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/cards.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/tables.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/employee-header.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/employee-detail.css') }}">
{% endblock %}

{% block content %}
{% from 'macros/_navigation.html' import section_nav %}
{% from 'macros/_info_display.html' import info_item, card_header, section_title %}

<div class="detail-page-layout">
    {# 좌측 섹션 네비게이션 #}
    {{ section_nav('회사 인사카드', company.name, variant='company') }}

    {# 메인 콘텐츠 #}
    <div class="detail-main-content">
        {# 페이지 헤더 #}
        <div class="detail-page-header">
            <h1 class="detail-page-title">{{ company.name }} 인사카드</h1>
            <div class="detail-page-actions">
                <a href="{{ url_for('personal.company_card_list') }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i>
                    <span>목록으로</span>
                </a>
            </div>
        </div>

        {# 헤더 카드 - 전달된 employee 데이터 사용 #}
        {% if employee %}
        {% include 'partials/employee_detail/_employee_header.html' %}
        {% endif %}

        {# 섹션 1: 소속정보 #}
        <section id="organization-info" class="content-section">
            {{ section_title('소속정보') }}
            <div class="card">
                {{ card_header('소속정보', 'fas fa-building') }}
                <div class="card-body">
                    <div class="info-grid">
                        {{ info_item('회사명', company.name, highlight=true) }}
                        {{ info_item('부서', contract.department) }}
                        {{ info_item('직급/직위', contract.position) }}
                        {{ info_item('사원번호', contract.employee_number) }}
                        {{ info_item('사업자번호', company.business_number) }}
                        {{ info_item('회사주소', company.address) }}
                        {{ info_item('회사전화', company.phone) }}
                    </div>
                </div>
            </div>
        </section>

        {# 섹션 2: 계약정보 #}
        <section id="contract-info" class="content-section">
            {{ section_title('계약정보') }}
            <div class="card">
                {{ card_header('계약정보', 'fas fa-file-contract') }}
                <div class="card-body">
                    <div class="info-grid">
                        {{ info_item('계약유형', contract_info.contract_type) }}
                        {{ info_item('계약시작일', contract_info.start_date) }}
                        {{ info_item('계약종료일', contract_info.end_date or '무기한') }}
                        {{ info_item('계약승인일', contract.approved_at) }}
                    </div>
                </div>
            </div>
        </section>

        {# 섹션 3: 급여정보 #}
        {% if salary %}
        <section id="salary-info" class="content-section">
            {{ section_title('급여정보') }}
            <div class="card">
                {{ card_header('급여정보', 'fas fa-won-sign') }}
                <div class="card-body">
                    <div class="info-grid">
                        {{ info_item('급여형태', salary.salary_type) }}
                        {{ info_item('기본급', ('{:,}'.format(salary.base_salary) ~ '원') if salary.base_salary else none) }}
                        {{ info_item('급여지급일', ('매월 ' ~ salary.payment_day ~ '일') if salary.payment_day else none) }}
                    </div>
                </div>
            </div>
        </section>
        {% endif %}

        {# 섹션 4: 연차 및 복리후생 #}
        {% if benefit %}
        <section id="benefit-info" class="content-section">
            {{ section_title('연차 및 복리후생') }}
            <div class="card">
                {{ card_header('연차 및 복리후생', 'fas fa-umbrella-beach') }}
                <div class="card-body">
                    <div class="info-grid">
                        {{ info_item('연차 발생일수', (benefit.annual_leave_granted|string ~ '일') if benefit.annual_leave_granted else none) }}
                        {{ info_item('연차 사용일수', (benefit.annual_leave_used|string ~ '일') if benefit.annual_leave_used else none) }}
                        {{ info_item('연차 잔여일수', (benefit.annual_leave_remaining|string ~ '일') if benefit.annual_leave_remaining else none, highlight=true) }}
                    </div>
                </div>
            </div>
        </section>
        {% endif %}

        {# 섹션 5: 4대보험 #}
        {% if insurance %}
        <section id="insurance-info" class="content-section">
            {{ section_title('4대보험') }}
            <div class="card">
                {{ card_header('4대보험', 'fas fa-shield-alt') }}
                <div class="card-body">
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">국민연금</div>
                            <div class="info-value">
                                {% if insurance.national_pension %}<span class="badge badge-success">가입</span>{% else %}<span class="badge badge-secondary">미가입</span>{% endif %}
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">건강보험</div>
                            <div class="info-value">
                                {% if insurance.health_insurance %}<span class="badge badge-success">가입</span>{% else %}<span class="badge badge-secondary">미가입</span>{% endif %}
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">고용보험</div>
                            <div class="info-value">
                                {% if insurance.employment_insurance %}<span class="badge badge-success">가입</span>{% else %}<span class="badge badge-secondary">미가입</span>{% endif %}
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">산재보험</div>
                            <div class="info-value">
                                {% if insurance.industrial_accident %}<span class="badge badge-success">가입</span>{% else %}<span class="badge badge-secondary">미가입</span>{% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        {% endif %}

        {# 섹션 6: 근로계약 및 연봉 #}
        <section id="employment-contract" class="content-section">
            {{ section_title('근로계약 및 연봉') }}

            {# 근로계약 이력 #}
            <div class="card">
                {{ card_header('근로계약 이력', 'fas fa-file-signature') }}
                <div class="card-body">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>계약일</th>
                                    <th>계약구분</th>
                                    <th>계약기간 시작</th>
                                    <th>계약기간 종료</th>
                                    <th>직원구분</th>
                                    <th>근무형태</th>
                                    <th>비고</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if contract_history_list %}
                                {% for history in contract_history_list %}
                                <tr>
                                    <td>{{ history.contract_date or '-' }}</td>
                                    <td>{{ history.contract_type or '-' }}</td>
                                    <td>{{ history.start_date or '-' }}</td>
                                    <td>{{ history.end_date or '무기한' }}</td>
                                    <td>{{ history.employee_type or '-' }}</td>
                                    <td>{{ history.work_type or '-' }}</td>
                                    <td>{{ history.note or '-' }}</td>
                                </tr>
                                {% endfor %}
                                {% else %}
                                <tr>
                                    <td colspan="7" class="table-empty">
                                        <i class="fas fa-file-signature"></i>
                                        <p>등록된 근로계약 정보가 없습니다</p>
                                    </td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            {# 연봉계약 이력 #}
            <div class="card mt-4">
                {{ card_header('연봉계약 이력', 'fas fa-won-sign') }}
                <div class="card-body">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>계약연도</th>
                                    <th>연봉</th>
                                    <th>인상률</th>
                                    <th>계약일</th>
                                    <th>비고</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if salary_history_list %}
                                {% for history in salary_history_list %}
                                <tr>
                                    <td>{{ history.year }}년</td>
                                    <td>{{ '{:,}'.format(history.annual_salary) if history.annual_salary else '-' }}원</td>
                                    <td>{{ history.increase_rate }}%</td>
                                    <td>{{ history.contract_date or '-' }}</td>
                                    <td>{{ history.note or '-' }}</td>
                                </tr>
                                {% endfor %}
                                {% else %}
                                <tr>
                                    <td colspan="5" class="table-empty">
                                        <i class="fas fa-won-sign"></i>
                                        <p>등록된 연봉계약 정보가 없습니다</p>
                                    </td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            {# 급여 지급 이력 #}
            <div class="card mt-4">
                {{ card_header('급여 지급 이력', 'fas fa-money-check-alt') }}
                <div class="card-body">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>지급년월</th>
                                    <th>기본급</th>
                                    <th>수당</th>
                                    <th>공제</th>
                                    <th>실지급액</th>
                                    <th>지급일</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if payment_history_list %}
                                {% for payment in payment_history_list %}
                                <tr>
                                    <td>{{ payment.year }}년 {{ payment.month }}월</td>
                                    <td>{{ '{:,}'.format(payment.base_salary) if payment.base_salary else '-' }}원</td>
                                    <td>{{ '{:,}'.format(payment.allowances) if payment.allowances else '-' }}원</td>
                                    <td>{{ '{:,}'.format(payment.deductions) if payment.deductions else '-' }}원</td>
                                    <td>{{ '{:,}'.format(payment.net_salary) if payment.net_salary else '-' }}원</td>
                                    <td>{{ payment.payment_date or '-' }}</td>
                                </tr>
                                {% endfor %}
                                {% else %}
                                <tr>
                                    <td colspan="6" class="table-empty">
                                        <i class="fas fa-money-check-alt"></i>
                                        <p>등록된 급여 지급 정보가 없습니다</p>
                                    </td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        {# 섹션 7: 인사이동 및 고과 #}
        <section id="personnel-movement" class="content-section">
            {{ section_title('인사이동 및 고과') }}

            {# 인사이동 이력 #}
            <div class="card">
                {{ card_header('인사이동 이력', 'fas fa-arrow-up') }}
                <div class="card-body">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>발령일</th>
                                    <th>발령구분</th>
                                    <th>발령전 직급</th>
                                    <th>발령후 직급</th>
                                    <th>발령전 직무</th>
                                    <th>발령후 직무</th>
                                    <th>비고</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if personnel_movement_list %}
                                {% for movement in personnel_movement_list %}
                                <tr>
                                    <td>{{ movement.effective_date or '-' }}</td>
                                    <td>{{ movement.movement_type or '-' }}</td>
                                    <td>{{ movement.from_position or '-' }}</td>
                                    <td>{{ movement.to_position or '-' }}</td>
                                    <td>{{ movement.from_duty or '-' }}</td>
                                    <td>{{ movement.to_duty or '-' }}</td>
                                    <td>{{ movement.note or '-' }}</td>
                                </tr>
                                {% endfor %}
                                {% else %}
                                <tr>
                                    <td colspan="7" class="table-empty">
                                        <i class="fas fa-arrow-up"></i>
                                        <p>등록된 인사이동 정보가 없습니다</p>
                                    </td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            {# 인사고과 #}
            <div class="card mt-4">
                {{ card_header('인사고과', 'fas fa-chart-line') }}
                <div class="card-body">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>평가연도</th>
                                    <th>평가유형</th>
                                    <th>평가등급</th>
                                    <th>점수</th>
                                    <th>평가자</th>
                                    <th>비고</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if evaluation_list %}
                                {% for evaluation in evaluation_list %}
                                <tr>
                                    <td>{{ evaluation.year }}년</td>
                                    <td>{{ evaluation.evaluation_type or '-' }}</td>
                                    <td>{{ evaluation.grade or '-' }}</td>
                                    <td>{{ evaluation.score or '-' }}</td>
                                    <td>{{ evaluation.evaluator or '-' }}</td>
                                    <td>{{ evaluation.note or '-' }}</td>
                                </tr>
                                {% endfor %}
                                {% else %}
                                <tr>
                                    <td colspan="6" class="table-empty">
                                        <i class="fas fa-chart-line"></i>
                                        <p>등록된 인사고과 정보가 없습니다</p>
                                    </td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            {# 교육훈련 #}
            <div class="card mt-4">
                {{ card_header('교육훈련', 'fas fa-chalkboard-teacher') }}
                <div class="card-body">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>교육명</th>
                                    <th>교육기간</th>
                                    <th>교육기관</th>
                                    <th>교육유형</th>
                                    <th>수료여부</th>
                                    <th>비고</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if training_list %}
                                {% for training in training_list %}
                                <tr>
                                    <td>{{ training.training_name or '-' }}</td>
                                    <td>{{ training.start_date }} ~ {{ training.end_date }}</td>
                                    <td>{{ training.institution or '-' }}</td>
                                    <td>{{ training.training_type or '-' }}</td>
                                    <td>{% if training.completed %}<span class="badge badge-success">수료</span>{% else %}<span class="badge badge-secondary">미수료</span>{% endif %}</td>
                                    <td>{{ training.note or '-' }}</td>
                                </tr>
                                {% endfor %}
                                {% else %}
                                <tr>
                                    <td colspan="6" class="table-empty">
                                        <i class="fas fa-chalkboard-teacher"></i>
                                        <p>등록된 교육훈련 정보가 없습니다</p>
                                    </td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        {# 섹션 8: 근태 및 비품 #}
        <section id="attendance-assets" class="content-section">
            {{ section_title('근태 및 비품') }}

            {# 근태 현황 #}
            <div class="card">
                {{ card_header('근태 현황', 'fas fa-calendar-check') }}
                <div class="card-body">
                    <div class="info-grid">
                        {{ info_item('출근일수', (attendance.work_days|string ~ '일') if attendance and attendance.work_days else '정보 없음') }}
                        {{ info_item('결근일수', (attendance.absent_days|string ~ '일') if attendance and attendance.absent_days else '0일') }}
                        {{ info_item('지각횟수', (attendance.late_count|string ~ '회') if attendance and attendance.late_count else '0회') }}
                        {{ info_item('조퇴횟수', (attendance.early_leave_count|string ~ '회') if attendance and attendance.early_leave_count else '0회') }}
                        {{ info_item('연차 사용', (benefit.annual_leave_used|string ~ '일') if benefit and benefit.annual_leave_used else '0일') }}
                        {{ info_item('연차 잔여', (benefit.annual_leave_remaining|string ~ '일') if benefit and benefit.annual_leave_remaining else '-', highlight=true) }}
                    </div>
                </div>
            </div>

            {# 비품지급 #}
            <div class="card mt-4">
                {{ card_header('비품지급', 'fas fa-laptop') }}
                <div class="card-body">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>지급일</th>
                                    <th>품목</th>
                                    <th>수량</th>
                                    <th>관리번호</th>
                                    <th>상태</th>
                                    <th>비고</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if asset_list %}
                                {% for asset in asset_list %}
                                <tr>
                                    <td>{{ asset.issue_date or '-' }}</td>
                                    <td>{{ asset.item_name or '-' }}</td>
                                    <td>{{ asset.quantity or 1 }}</td>
                                    <td>{{ asset.asset_number or '-' }}</td>
                                    <td>
                                        {% if asset.status == 'in_use' %}
                                        <span class="badge badge-success">사용중</span>
                                        {% elif asset.status == 'returned' %}
                                        <span class="badge badge-secondary">반납</span>
                                        {% else %}
                                        <span class="badge badge-warning">{{ asset.status or '-' }}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ asset.note or '-' }}</td>
                                </tr>
                                {% endfor %}
                                {% else %}
                                <tr>
                                    <td colspan="6" class="table-empty">
                                        <i class="fas fa-laptop"></i>
                                        <p>등록된 비품지급 정보가 없습니다</p>
                                    </td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
    </div>
</div>

{# 모바일 섹션 네비게이션 토글 버튼 #}
<button class="mobile-section-nav-toggle" id="mobileNavToggle">
    <i class="fas fa-bars"></i>
</button>

{# 모바일 오버레이 #}
<div class="section-nav-overlay" id="sectionNavOverlay"></div>
{% endblock %}

{% block extra_js %}
<script type="module" src="{{ url_for('static', filename='js/pages/employee-detail.js') }}"></script>
{% endblock %}
