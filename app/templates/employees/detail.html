{% extends "base.html" %}

{% block title %}{{ employee.name }} - 인사카드{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/layouts/section-nav.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/layouts/right-sidebar.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/employee-header.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/business-card.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/cards.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/tables.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/employee-detail.css') }}">
{% endblock %}

{% block content %}
{% from 'macros/_navigation.html' import section_nav %}
<div class="detail-page-layout">
    {# 좌측 섹션 네비게이션 #}
    {{ section_nav('인사카드', employee.name, variant='full', employee=employee) }}

    {# 메인 콘텐츠 #}
    <div class="detail-main-content">
        {# 페이지 헤더 #}
        <div class="detail-page-header">
            {% if current_user and current_user.role == 'employee' %}
            <h1 class="detail-page-title">내 인사카드</h1>
            {% else %}
            <h1 class="detail-page-title">직원 상세 정보</h1>
            {% endif %}
            <div class="detail-page-actions">
                {% if not current_user or current_user.role != 'employee' %}
                <a href="{{ url_for('employees.employee_list') }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i>
                    <span>목록으로</span>
                </a>
                {% endif %}
                {% if not is_readonly %}
                <a href="{{ url_for('employees.employee_edit', employee_id=employee.id) }}" class="btn btn-primary">
                    <i class="fas fa-edit"></i>
                    <span>수정</span>
                </a>
                {% if current_user and current_user.is_admin %}
                <button class="btn btn-danger" onclick="deleteEmployee({{ employee.id }}, '{{ employee.name }}')">
                    <i class="fas fa-trash"></i>
                    <span>삭제</span>
                </button>
                {% endif %}
                {% endif %}
            </div>
        </div>

        {# 직원 헤더 카드 #}
        {% include 'partials/employee_detail/_employee_header.html' %}

        {# 섹션 1-6: 기본정보 (개인정보, 소속정보, 계약정보, 급여정보, 복리후생, 4대보험) #}
        {% include 'partials/employee_detail/_basic_info.html' %}

        {# 섹션 7-11: 이력 및 경력 (학력, 경력, 자격증, 언어능력, 병역/프로젝트/수상) #}
        {% include 'partials/employee_detail/_history_info.html' %}

        {# 섹션 12-14: 인사기록 (근로계약 및 연봉, 인사이동 및 고과, 근태 및 비품) #}
        {% include 'partials/employee_detail/_hr_records.html' %}
    </div>
</div>

{# 모바일 섹션 네비게이션 토글 버튼 #}
<button class="mobile-section-nav-toggle" id="mobileNavToggle">
    <i class="fas fa-bars"></i>
</button>

{# 모바일 오버레이 #}
<div class="section-nav-overlay" id="sectionNavOverlay"></div>

{# 명함 업로드 모달 #}
{% if can_edit_business_card %}
{% include 'partials/_business_card_modal.html' %}
{% endif %}
{% endblock %}

{% block sidebar_right %}
{% include 'partials/_attachment_sidebar.html' %}
{% endblock %}

{% block extra_js %}
<script type="module" src="{{ url_for('static', filename='js/pages/employee-detail.js') }}"></script>
<script src="{{ url_for('static', filename='js/components/business-card.js') }}"></script>
<script>
function deleteEmployee(id, name) {
    if (confirm(`"${name}" 직원을 삭제하시겠습니까?\n이 작업은 되돌릴 수 없습니다.`)) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/employees/${id}/delete`;
        document.body.appendChild(form);
        form.submit();
    }
}
</script>
{% endblock %}
