{% extends "base.html" %}

{% block title %}이력정보 수정 - {{ employee.name }} - 인사카드 관리 시스템{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/layouts/section-nav.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/cards.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/employee-form.css') }}">
{% endblock %}

{% block content %}
<div class="form-page-layout">
    {# 좌측: 섹션 네비게이션 #}
    <aside class="section-nav" id="sectionNav">
        <div class="section-nav-header">
            <div class="section-nav-title">이력정보 수정</div>
            <div class="section-nav-subtitle">{{ employee.name }}</div>
        </div>
        <nav class="section-nav-menu">
            <div class="section-nav-group">
                <div class="section-nav-group-title">이력 및 경력</div>
                <a href="#education-info" class="section-nav-item active">
                    <i class="fas fa-graduation-cap"></i>
                    <span>학력정보</span>
                </a>
                <a href="#career-info" class="section-nav-item">
                    <i class="fas fa-briefcase"></i>
                    <span>경력정보</span>
                </a>
                <a href="#certificate-info" class="section-nav-item">
                    <i class="fas fa-certificate"></i>
                    <span>자격증 및 면허</span>
                </a>
                <a href="#language-info" class="section-nav-item">
                    <i class="fas fa-language"></i>
                    <span>언어능력</span>
                </a>
                <a href="#military-info" class="section-nav-item">
                    <i class="fas fa-shield-alt"></i>
                    <span>병역정보</span>
                </a>
                <a href="#project-info" class="section-nav-item">
                    <i class="fas fa-project-diagram"></i>
                    <span>프로젝트</span>
                </a>
                <a href="#award-info" class="section-nav-item">
                    <i class="fas fa-award"></i>
                    <span>수상내역</span>
                </a>
            </div>
        </nav>
    </aside>

    {# 메인 콘텐츠: 폼 #}
    <main class="form-main-content">
        {# 페이지 헤더 #}
        <div class="form-page-header">
            <h1 class="form-page-title">이력정보 수정</h1>
            <div class="form-page-actions">
                <a href="{{ url_for('employees.employee_detail', employee_id=employee.id, view='history') }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i>
                    <span>취소</span>
                </a>
            </div>
        </div>

        <div class="alert alert-info mb-5">
            <i class="fas fa-info-circle"></i>
            <span>학력, 경력, 자격증, 언어능력, 병역, 프로젝트, 수상 정보를 수정할 수 있습니다.</span>
        </div>

        <form method="POST" action="{{ url_for('employees.employee_update_history', employee_id=employee.id) }}" class="employee-form" id="employeeForm">

            {# 섹션 1: 학력정보 #}
            {% include 'partials/employee_form/_education_info.html' %}

            {# 섹션 2: 경력정보 #}
            {% include 'partials/employee_form/_career_info.html' %}

            {# 섹션 3: 자격증 #}
            {% include 'partials/employee_form/_certificate_info.html' %}

            {# 섹션 4: 언어능력 #}
            {% include 'partials/employee_form/_language_info.html' %}

            {# 섹션 5: 병역정보 #}
            {% include 'partials/employee_form/_military_info.html' %}

            {# 섹션 6: 프로젝트 #}
            {% include 'partials/employee_form/_project_info.html' %}

            {# 섹션 7: 수상내역 #}
            <section class="form-section" id="award-info">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-award"></i>
                            수상내역
                        </h2>
                        <button type="button" class="btn btn-sm btn-secondary" id="addAward">
                            <i class="fas fa-plus"></i> 추가
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="dynamic-list" id="awardList">
                            {% if award_list %}
                                {% for award in award_list %}
                                <div class="dynamic-item" data-index="{{ loop.index0 }}">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label class="form-label">수상일</label>
                                            <input type="date" name="award_date[]" class="form-input"
                                                   value="{{ award.award_date or '' }}">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">수상명</label>
                                            <input type="text" name="award_name[]" class="form-input"
                                                   value="{{ award.award_name or '' }}" placeholder="수상명">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">수여기관</label>
                                            <input type="text" name="award_issuer[]" class="form-input"
                                                   value="{{ award.issuer or '' }}" placeholder="수여기관">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">비고</label>
                                            <input type="text" name="award_note[]" class="form-input"
                                                   value="{{ award.note or '' }}" placeholder="비고">
                                        </div>
                                    </div>
                                    <button type="button" class="btn-remove" title="삭제">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                {% endfor %}
                            {% else %}
                            <div class="dynamic-item" data-index="0">
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label class="form-label">수상일</label>
                                        <input type="date" name="award_date[]" class="form-input">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">수상명</label>
                                        <input type="text" name="award_name[]" class="form-input" placeholder="수상명">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">수여기관</label>
                                        <input type="text" name="award_issuer[]" class="form-input" placeholder="수여기관">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">비고</label>
                                        <input type="text" name="award_note[]" class="form-input" placeholder="비고">
                                    </div>
                                </div>
                                <button type="button" class="btn-remove" title="삭제">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </section>

            {# 폼 제출 버튼 #}
            <div class="form-submit-section">
                <div class="form-submit-info">
                    입력하신 정보는 즉시 저장됩니다.
                </div>
                <div class="form-submit-actions">
                    <a href="{{ url_for('employees.employee_detail', employee_id=employee.id, view='history') }}" class="btn btn-secondary btn-lg">
                        <i class="fas fa-times"></i>
                        <span>취소</span>
                    </a>
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="fas fa-save"></i>
                        <span>수정 완료</span>
                    </button>
                </div>
            </div>

        </form>
    </main>
</div>
{% endblock %}

{% block extra_js %}
<script type="module" src="{{ url_for('static', filename='js/pages/employee-form.js') }}"></script>
<script>
// 수상내역 동적 폼 처리
document.addEventListener('DOMContentLoaded', function() {
    const addAwardBtn = document.getElementById('addAward');
    const awardList = document.getElementById('awardList');

    if (addAwardBtn && awardList) {
        addAwardBtn.addEventListener('click', function() {
            const items = awardList.querySelectorAll('.dynamic-item');
            const newIndex = items.length;

            const newItem = document.createElement('div');
            newItem.className = 'dynamic-item';
            newItem.setAttribute('data-index', newIndex);
            newItem.innerHTML = `
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">수상일</label>
                        <input type="date" name="award_date[]" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">수상명</label>
                        <input type="text" name="award_name[]" class="form-input" placeholder="수상명">
                    </div>
                    <div class="form-group">
                        <label class="form-label">수여기관</label>
                        <input type="text" name="award_issuer[]" class="form-input" placeholder="수여기관">
                    </div>
                    <div class="form-group">
                        <label class="form-label">비고</label>
                        <input type="text" name="award_note[]" class="form-input" placeholder="비고">
                    </div>
                </div>
                <button type="button" class="btn-remove" title="삭제">
                    <i class="fas fa-times"></i>
                </button>
            `;
            awardList.appendChild(newItem);
        });

        // 삭제 버튼 이벤트 위임
        awardList.addEventListener('click', function(e) {
            if (e.target.closest('.btn-remove')) {
                e.target.closest('.dynamic-item').remove();
            }
        });
    }
});
</script>
{% endblock %}
