{# ========================================
   개인계정용 첨부파일 사이드바 템플릿
   - 필요 변수: attachment_list
   - 사용처: employee_detail_basic.html, employee_detail_history.html (employee role)
   - 회사 관련 카테고리 제외: profile_photo, business_card_front, business_card_back
   ======================================== #}
{% set company_categories = ['profile_photo', 'business_card_front', 'business_card_back'] %}
{% set personal_attachments = attachment_list|rejectattr('category', 'in', company_categories)|list if attachment_list else [] %}

<aside class="right-sidebar">
    <div class="right-sidebar-header">
        <div class="right-sidebar-header-row">
            <h2 class="right-sidebar-title">개인 첨부서류</h2>
        </div>
    </div>
    <div class="right-sidebar-content">
        <div class="file-upload-area" id="fileUploadArea">
            <div class="file-upload-icon">
                <i class="fas fa-cloud-upload-alt"></i>
            </div>
            <div class="file-upload-text">파일을 드래그하거나 클릭</div>
            <div class="file-upload-hint">PDF, JPG, PNG (최대 10MB)</div>
        </div>

        <div id="fileList">
            {% if personal_attachments %}
                {% for attachment in personal_attachments|sort(attribute='category') %}
                <div class="file-card" data-attachment-id="{{ attachment.id }}">
                    <div class="file-icon">
                        {% if attachment.file_type in ['jpg', 'jpeg', 'png', 'gif'] %}
                            <i class="fas fa-file-image"></i>
                        {% elif attachment.file_type == 'pdf' %}
                            <i class="fas fa-file-pdf"></i>
                        {% elif attachment.file_type in ['doc', 'docx'] %}
                            <i class="fas fa-file-word"></i>
                        {% elif attachment.file_type in ['xls', 'xlsx'] %}
                            <i class="fas fa-file-excel"></i>
                        {% else %}
                            <i class="fas fa-file"></i>
                        {% endif %}
                    </div>
                    <div class="file-info">
                        <div class="file-name">{{ attachment.file_name }}</div>
                        <div class="file-meta">
                            <span class="file-category">{{ attachment.category }}</span>
                            <span class="file-size">{{ (attachment.file_size / 1024)|round(1) }}KB</span>
                        </div>
                    </div>
                    <div class="file-actions">
                        <a href="{{ attachment.file_path }}" target="_blank" class="btn-icon" title="보기">
                            <i class="fas fa-eye"></i>
                        </a>
                        <a href="{{ attachment.file_path }}" download class="btn-icon" title="다운로드">
                            <i class="fas fa-download"></i>
                        </a>
                        <button type="button" class="btn-icon btn-delete-attachment" data-id="{{ attachment.id }}" title="삭제">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="empty-state-small">
                    <i class="fas fa-folder-open"></i>
                    <p>등록된 개인 첨부파일이 없습니다</p>
                </div>
            {% endif %}
        </div>
    </div>
</aside>
