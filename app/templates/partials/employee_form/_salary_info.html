{#
    직원 폼 - 급여정보 섹션
    employee: 직원 객체 (수정 모드일 때)
    salary: 급여 정보 객체
    has_person_contract: 승인된 개인계약 존재 여부 (계약 후 수정 불가용)
#}
{# 계약 후 수정 불가 플래그: 승인된 개인계약이 있을 때 #}
{% set is_contract_readonly = has_person_contract %}

<section class="form-section" id="salary-info">
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">
                <i class="fas fa-won-sign"></i>
                급여정보
                {% if is_contract_readonly %}<small class="text-muted">(계약 확정)</small>{% endif %}
            </h2>
            {% if not is_contract_readonly %}
            <button type="button" class="btn btn-outline-primary btn-sm" id="openSalaryCalculatorBtn">
                <i class="fas fa-calculator"></i>
                포괄임금 계산기
            </button>
            {% endif %}
        </div>
        <div class="card-body">
            <!-- 포괄임금제 요약 (계산기 사용 시 표시) -->
            <div class="comprehensive-salary-summary hidden" id="comprehensiveSalarySummary">
                <div class="summary-header">
                    <i class="fas fa-info-circle"></i>
                    <span>포괄임금제 적용</span>
                </div>
                <div class="summary-content">
                    <div class="summary-item">
                        <span class="label">연봉</span>
                        <span class="value" id="summaryAnnualSalary">-</span>
                    </div>
                    <div class="summary-item">
                        <span class="label">통상임금(시급)</span>
                        <span class="value" id="summaryHourlyWage">-</span>
                    </div>
                    <div class="summary-item">
                        <span class="label">연장근로</span>
                        <span class="value" id="summaryOvertimeHours">-</span>
                    </div>
                </div>
            </div>

            <div class="form-grid">
                <div class="form-group">
                    <label for="base_salary" class="form-label">기본급</label>
                    <input type="number" id="base_salary" name="base_salary" class="form-input{% if is_contract_readonly %} readonly-field{% endif %}"
                           value="{{ salary.base_salary if salary and salary.base_salary else '' }}"
                           placeholder="3000000"
                           {% if is_contract_readonly %}readonly disabled{% endif %}>
                    {% if not is_contract_readonly %}<small class="form-help">월 기본급 (원)</small>{% endif %}
                </div>

                <div class="form-group">
                    <label for="position_allowance" class="form-label">직책수당</label>
                    <input type="number" id="position_allowance" name="position_allowance" class="form-input{% if is_contract_readonly %} readonly-field{% endif %}"
                           value="{{ salary.position_allowance if salary and salary.position_allowance else '' }}"
                           placeholder="200000"
                           {% if is_contract_readonly %}readonly disabled{% endif %}>
                </div>

                <div class="form-group">
                    <label for="meal_allowance" class="form-label">식대</label>
                    <input type="number" id="meal_allowance" name="meal_allowance" class="form-input{% if is_contract_readonly %} readonly-field{% endif %}"
                           value="{{ salary.meal_allowance if salary and salary.meal_allowance else '' }}"
                           placeholder="100000"
                           {% if is_contract_readonly %}readonly disabled{% endif %}>
                </div>

                <div class="form-group">
                    <label for="transport_allowance" class="form-label">교통비</label>
                    <input type="number" id="transport_allowance" name="transport_allowance" class="form-input{% if is_contract_readonly %} readonly-field{% endif %}"
                           value="{{ salary.transport_allowance if salary and salary.transport_allowance else '' }}"
                           placeholder="100000"
                           {% if is_contract_readonly %}readonly disabled{% endif %}>
                </div>

                <div class="form-group">
                    <label for="bonus_rate" class="form-label">상여금률 (%)</label>
                    <input type="number" id="bonus_rate" name="bonus_rate" class="form-input{% if is_contract_readonly %} readonly-field{% endif %}"
                           value="{{ salary.bonus_rate if salary and salary.bonus_rate else '' }}"
                           placeholder="200" step="1" min="0" max="1000"
                           {% if is_contract_readonly %}readonly disabled{% endif %}>
                </div>

                <div class="form-group">
                    <label for="pay_type" class="form-label">급여 지급방식</label>
                    <select id="pay_type" name="pay_type" class="form-input{% if is_contract_readonly %} readonly-field{% endif %}"
                            {% if is_contract_readonly %}disabled{% endif %}>
                        <option value="">선택하세요</option>
                        <option value="monthly" {% if salary and salary.pay_type == 'monthly' %}selected{% endif %}>월급</option>
                        <option value="hourly" {% if salary and salary.pay_type == 'hourly' %}selected{% endif %}>시급</option>
                        <option value="daily" {% if salary and salary.pay_type == 'daily' %}selected{% endif %}>일급</option>
                        <option value="annual" {% if salary and salary.pay_type == 'annual' %}selected{% endif %}>연봉</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="bank_name" class="form-label">은행</label>
                    <select id="bank_name" name="bank_name" class="form-input{% if is_contract_readonly %} readonly-field{% endif %}"
                            {% if is_contract_readonly %}disabled{% endif %}>
                        <option value="">선택하세요</option>
                        {% for bank in ['국민은행', '신한은행', '우리은행', '하나은행', 'NH농협', '기업은행', 'SC제일은행', '케이뱅크', '카카오뱅크', '토스뱅크'] %}
                        <option value="{{ bank }}" {% if salary and salary.bank_name == bank %}selected{% endif %}>{{ bank }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="account_number" class="form-label">계좌번호</label>
                    <input type="text" id="account_number" name="account_number" class="form-input{% if is_contract_readonly %} readonly-field{% endif %}"
                           value="{{ salary.account_number if salary and salary.account_number else '' }}"
                           placeholder="123-456-789012"
                           {% if is_contract_readonly %}readonly disabled{% endif %}>
                </div>
            </div>

            <!-- 포괄임금제 상세 필드 (확장 영역) -->
            <div class="comprehensive-salary-details hidden" id="comprehensiveSalaryDetails">
                <h3 class="section-subtitle">
                    <i class="fas fa-calculator"></i>
                    포괄임금제 수당 내역
                </h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="annual_salary" class="form-label">연봉</label>
                        <input type="number" id="annual_salary" name="annual_salary" class="form-input"
                               value="{{ salary.annual_salary if salary and salary.annual_salary else '' }}"
                               placeholder="52000000" readonly>
                    </div>
                    <div class="form-group">
                        <label for="hourly_wage" class="form-label">통상임금(시급)</label>
                        <input type="number" id="hourly_wage" name="hourly_wage" class="form-input"
                               value="{{ salary.hourly_wage if salary and salary.hourly_wage else '' }}"
                               placeholder="20733" readonly>
                    </div>
                    <div class="form-group">
                        <label for="overtime_hours" class="form-label">연장근로시간(월)</label>
                        <input type="number" id="overtime_hours" name="overtime_hours" class="form-input"
                               value="{{ salary.overtime_hours if salary and salary.overtime_hours else '' }}"
                               placeholder="24" readonly>
                    </div>
                    <div class="form-group">
                        <label for="overtime_allowance" class="form-label">연장근로수당</label>
                        <input type="number" id="overtime_allowance" name="overtime_allowance" class="form-input"
                               value="{{ salary.overtime_allowance if salary and salary.overtime_allowance else '' }}"
                               placeholder="746388" readonly>
                    </div>
                    <div class="form-group">
                        <label for="night_hours" class="form-label">야간근로시간(월)</label>
                        <input type="number" id="night_hours" name="night_hours" class="form-input"
                               value="{{ salary.night_hours if salary and salary.night_hours else '' }}"
                               placeholder="8" readonly>
                    </div>
                    <div class="form-group">
                        <label for="night_allowance" class="form-label">야간근로수당</label>
                        <input type="number" id="night_allowance" name="night_allowance" class="form-input"
                               value="{{ salary.night_allowance if salary and salary.night_allowance else '' }}"
                               placeholder="82932" readonly>
                    </div>
                    <div class="form-group">
                        <label for="holiday_days" class="form-label">휴일근로일수(월)</label>
                        <input type="number" id="holiday_days" name="holiday_days" class="form-input"
                               value="{{ salary.holiday_days if salary and salary.holiday_days else '' }}"
                               placeholder="1" readonly>
                    </div>
                    <div class="form-group">
                        <label for="holiday_allowance" class="form-label">휴일근로수당</label>
                        <input type="number" id="holiday_allowance" name="holiday_allowance" class="form-input"
                               value="{{ salary.holiday_allowance if salary and salary.holiday_allowance else '' }}"
                               placeholder="248796" readonly>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- 급여 계산기 모달 Include -->
{% include 'partials/_salary_calculator_modal.html' %}
