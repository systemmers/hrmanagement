{% extends "base.html" %}

{% block title %}{{ employee.name }} - 기본정보{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/layouts/section-nav.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/layouts/right-sidebar.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/employee-header.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/cards.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/tables.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/employee-detail.css') }}">
{% endblock %}

{% block content %}
{% from 'macros/_navigation.html' import section_nav %}
<div class="detail-page-layout">
    {# 좌측 섹션 네비게이션 #}
    {{ section_nav('내 기본정보', employee.name, variant='basic', employee=employee) }}

    {# 메인 콘텐츠 #}
    <div class="detail-main-content">
        {# 페이지 헤더 #}
        <div class="detail-page-header">
            <h1 class="detail-page-title">내 기본정보</h1>
            <div class="detail-page-actions">
                <a href="{{ url_for('employees.employee_edit_basic', employee_id=employee.id) }}" class="btn btn-primary">
                    <i class="fas fa-edit"></i>
                    <span>수정</span>
                </a>
            </div>
        </div>

        {# 통합 헤더 카드 - 개인 계정 variant #}
        {% set variant = 'personal' %}
        {% include 'partials/employee_detail/_employee_header.html' %}

        {# 개인 기본정보 섹션만 포함 #}
        {% from 'macros/_info_display.html' import info_item, card_header, section_title %}

        <section id="personal-info" class="content-section">
            {{ section_title('개인 기본정보') }}
            <div class="card">
                {{ card_header('개인 기본정보', 'fas fa-user') }}
                <div class="card-body">
                    <div class="info-grid">
                        {{ info_item('성명 (한글)', employee.name) }}
                        {{ info_item('여권명 (영문)', employee.english_name) }}
                        {{ info_item('주민등록번호', employee.resident_number) }}
                        {{ info_item('생년월일', employee.birth_date) }}
                        {{ info_item('성별', get_gender_label(employee.gender)) }}
                        <div class="info-item">
                            <div class="info-label">결혼여부</div>
                            <div class="info-value{% if not family_list %} empty{% endif %}">
                                {% if family_list|selectattr('relation', 'equalto', 'spouse')|list %}기혼{% else %}미혼{% endif %}
                            </div>
                        </div>
                        {{ info_item('휴대전화', format_phone(employee.phone)) }}
                        {{ info_item('내선번호', employee.internal_phone) }}
                        {{ info_item('개인 이메일', employee.email, highlight=true) }}
                        {{ info_item('회사 이메일', employee.company_email) }}
                        <div class="info-item">
                            <div class="info-label">비상연락처</div>
                            <div class="info-value{% if not employee.emergency_contact %} empty{% endif %}">
                                {{ employee.emergency_contact or '정보 없음' }}{% if employee.emergency_relation %} ({{ employee.emergency_relation }}){% endif %}
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: var(--space-5);">
                        {{ info_item('주민등록상 주소', employee.address) }}
                    </div>
                </div>
            </div>
        </section>

        {# 가족정보 섹션 #}
        <section id="family-info" class="content-section">
            {{ section_title('가족정보') }}
            <div class="card">
                {{ card_header('가족정보', 'fas fa-users') }}
                <div class="card-body">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>관계</th>
                                    <th>성명</th>
                                    <th>생년월일</th>
                                    <th>직업</th>
                                    <th>연락처</th>
                                    <th>동거여부</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if family_list %}
                                {% for family in family_list %}
                                <tr>
                                    <td>{{ get_relation_label(family.relation) }}</td>
                                    <td>{{ family.name }}</td>
                                    <td>{{ family.birth_date or '-' }}</td>
                                    <td>{{ family.occupation or '-' }}</td>
                                    <td>{{ family.phone or '-' }}</td>
                                    <td>{% if family.living_together %}<span class="badge badge-success">동거</span>{% else %}<span class="badge badge-secondary">별거</span>{% endif %}</td>
                                </tr>
                                {% endfor %}
                                {% else %}
                                <tr>
                                    <td colspan="6" class="table-empty">
                                        <i class="fas fa-users"></i>
                                        <p>등록된 가족정보가 없습니다</p>
                                    </td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
    </div>
</div>

{# 모바일 섹션 네비게이션 토글 버튼 #}
<button class="mobile-section-nav-toggle" id="mobileNavToggle">
    <i class="fas fa-bars"></i>
</button>

{# 모바일 오버레이 #}
<div class="section-nav-overlay" id="sectionNavOverlay"></div>
{% endblock %}

{% block sidebar_right %}
{% include 'partials/_attachment_sidebar_personal.html' %}
{% endblock %}

{% block extra_js %}
<script type="module" src="{{ url_for('static', filename='js/pages/employee-detail.js') }}"></script>
{% endblock %}
