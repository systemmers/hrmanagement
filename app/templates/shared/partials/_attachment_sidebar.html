{# ========================================
   첨부파일 사이드바 공유 템플릿
   - 필요 변수: attachment_list
   - 선택 변수: is_readonly (True일 경우 업로드/삭제 버튼 숨김)
   - 사용처: employee_detail.html, employee_form.html, profile, mypage
   - Phase 33: BEM 클래스 적용
   - 2026-01-12: 세로형 컴팩트 카드 적용 (1열 그리드)
   - 2026-01-12: MIME 타입(image/png) 및 확장자(png) 모두 지원
   ======================================== #}
<aside class="right-sidebar">
    <div class="right-sidebar-header">
        <div class="right-sidebar-header-row">
            <h2 class="right-sidebar-title">개인 첨부서류</h2>
            {% if not is_readonly %}
            <button type="button" class="btn-ai-analyze" id="btnAiAnalyze" title="AI 첨부서류 분석">
                <i class="fas fa-wand-magic-sparkles"></i>
                <span>AI 분석</span>
            </button>
            {% endif %}
        </div>
    </div>
    <div class="right-sidebar-content">
        {# 조회 전용 모드가 아닐 때만 업로드 영역 표시 #}
        {% if not is_readonly %}
        <div class="file-upload-area file-upload-area--compact" id="fileUploadArea">
            <div class="file-upload-area__icon">
                <i class="fas fa-cloud-upload-alt"></i>
            </div>
            <div class="file-upload-area__text">파일을 드래그하거나 클릭</div>
            <div class="file-upload-area__hint">PDF, JPG, PNG (최대 10MB)</div>
        </div>
        {% endif %}

        <div id="fileList" class="file-list file-list--cards">
            {% if attachment_list %}
                {% for attachment in attachment_list|sort(attribute='category') %}
                {# file_path 정규화: /static/으로 시작하지 않으면 /static/uploads/ 접두사 추가 #}
                {% set file_url = attachment.file_path if attachment.file_path.startswith('/static/') else '/static/uploads/' ~ attachment.file_path %}
                {# file_type: MIME 타입(image/png) 또는 확장자(png) 모두 지원 #}
                {% set is_image = attachment.file_type.startswith('image/') or attachment.file_type in ['jpg', 'jpeg', 'png', 'gif', 'webp', 'bmp'] %}
                {% set is_pdf = attachment.file_type == 'application/pdf' or attachment.file_type == 'pdf' %}
                {% set is_word = attachment.file_type in ['application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'doc', 'docx'] %}
                {% set is_excel = attachment.file_type in ['application/vnd.ms-excel', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'xls', 'xlsx'] %}
                {% set is_ppt = attachment.file_type in ['application/vnd.ms-powerpoint', 'application/vnd.openxmlformats-officedocument.presentationml.presentation', 'ppt', 'pptx'] %}
                {% set is_archive = attachment.file_type in ['application/zip', 'application/x-zip-compressed', 'zip'] %}
                <div class="file-card file-card--vertical file-card--compact file-card--uploaded" data-attachment-id="{{ attachment.id }}">
                    <div class="file-card__icon {% if is_image %}file-card__icon--thumbnail{% endif %}">
                        {% if is_image %}
                            <img src="{{ file_url }}"
                                 alt="{{ attachment.file_name }}"
                                 loading="lazy">
                        {% elif is_pdf %}
                            <i class="fas fa-file-pdf"></i>
                        {% elif is_word %}
                            <i class="fas fa-file-word"></i>
                        {% elif is_excel %}
                            <i class="fas fa-file-excel"></i>
                        {% elif is_ppt %}
                            <i class="fas fa-file-powerpoint"></i>
                        {% elif is_archive %}
                            <i class="fas fa-file-archive"></i>
                        {% else %}
                            <i class="fas fa-file"></i>
                        {% endif %}
                    </div>
                    <div class="file-card__info">
                        <div class="file-card__label">{{ attachment.category }}</div>
                        <div class="file-card__name">{{ attachment.file_name }}</div>
                        <div class="file-card__meta">
                            <span class="file-card__date">{{ attachment.upload_date[:10] if attachment.upload_date else '' }}</span>
                            <span class="file-card__size">{{ (attachment.file_size / 1024)|round(1) }}KB</span>
                        </div>
                    </div>
                    <div class="file-card__actions file-card__actions--bottom">
                        <a href="{{ file_url }}" target="_blank" class="file-card__btn" title="보기">
                            <i class="fas fa-eye"></i>
                        </a>
                        <a href="{{ file_url }}" download class="file-card__btn" title="다운로드">
                            <i class="fas fa-download"></i>
                        </a>
                        {# 조회 전용 모드가 아닐 때만 삭제 버튼 표시 #}
                        {% if not is_readonly %}
                        <button type="button" class="file-card__btn file-card__btn--danger btn-delete-attachment" data-id="{{ attachment.id }}" title="삭제">
                            <i class="fas fa-trash"></i>
                        </button>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="file-empty-state">
                    <i class="file-empty-state__icon fas fa-folder-open"></i>
                    <p class="file-empty-state__text">등록된 첨부파일이 없습니다</p>
                </div>
            {% endif %}
        </div>
    </div>
</aside>
