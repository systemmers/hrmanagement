{#
    Profile Header v3.3 - 통합 프로필 헤더 카드
    2칼럼 레이아웃 (정보 + 명함)

    Parameters:
    - employee: 직원/프로필 객체 (필수)
    - page_mode: 'hr_card' | 'profile' (선택적, 기본: 자동 감지)
    - account_type: 'corporate' | 'personal' | 'employee_sub' (선택적, 기본: 자동 감지)
    - get_status_text: 상태 텍스트 함수 (선택적)
    - calculate_tenure: 재직기간 계산 함수 (선택적)
    - business_card_front: 명함 앞면 첨부파일 객체 (선택적)
    - business_card_back: 명함 뒷면 첨부파일 객체 (선택적)
    - can_edit_business_card: 명함 편집 권한 여부 (선택적)
    - company: 법인 객체 (선택적)
    - variant: deprecated, account_type 사용 권장

    Theme Classes:
    - .profile-header (Corporate Blue - 기본)
    - .profile-header--personal (Personal Emerald)
    - .profile-header--employee (Employee Sub Indigo)

    Modifier Classes:
    - .profile-header--no-card (명함 칼럼 숨김)
    - .profile-header--compact (컴팩트 버전)
#}

{# 테마 결정: account_type 기반 (variant는 하위 호환용) #}
{% set effective_account_type = account_type|default(variant|default('corporate')) %}
{% set theme_class = 'profile-header--personal' if effective_account_type == 'personal'
                else ('profile-header--employee' if effective_account_type == 'employee_sub' else '') %}

{# 명함 표시 여부: page_mode == 'hr_card'일 때만 표시 #}
{% set show_card = page_mode == 'hr_card' %}
{% set card_class = '' if show_card else 'profile-header--no-card' %}

{# 모드 결정: hr_card(인사카드) vs profile(프로필) #}
{% set is_hr_card_mode = page_mode == 'hr_card' %}

<div class="profile-header {{ theme_class }} {{ card_class }}">
    <div class="profile-header__content">
        <!-- 정보 칼럼 -->
        <div class="profile-header__column profile-header__column--info">
            <!-- 1행: 사진 + 기본정보 -->
            <div class="profile-header__row">
                <div class="profile-header__photo">
                    {% if employee.photo %}
                    <img src="{{ employee.photo }}" alt="{{ employee.name }} 증명사진">
                    {% else %}
                    <div class="profile-header__photo-initial">{{ employee.name[:1] if employee.name else '?' }}</div>
                    {% endif %}
                </div>
                <div class="profile-header__info">
                    <div class="profile-header__name">{{ employee.name }}</div>
                    <div class="profile-header__name-en">{{ (employee.english_name or employee.name)|upper }}</div>
                    <div class="profile-header__meta">
                        {% if is_hr_card_mode %}
                        {# 인사카드 모드: 소속 정보 #}
                        <div class="profile-header__meta-item">
                            <i class="fas fa-building" aria-hidden="true"></i>
                            <span>{{ employee.department or '-' }}</span>
                        </div>
                        <div class="profile-header__meta-item">
                            <i class="fas fa-user-tie" aria-hidden="true"></i>
                            <span>{{ employee.position or '-' }}</span>
                        </div>
                        {% else %}
                        {# 프로필 모드: 연락처 정보 #}
                        {% if effective_account_type == 'corporate' %}
                        <div class="profile-header__meta-item">
                            <i class="fas fa-building" aria-hidden="true"></i>
                            <span>{{ company.name if company else '-' }}</span>
                        </div>
                        <div class="profile-header__meta-item">
                            <i class="fas fa-user-tie" aria-hidden="true"></i>
                            <span>관리자</span>
                        </div>
                        {% else %}
                        <div class="profile-header__meta-item">
                            <i class="fas fa-user" aria-hidden="true"></i>
                            <span>{{ '개인 회원' if effective_account_type == 'personal' else '개인 프로필' }}</span>
                        </div>
                        <div class="profile-header__meta-item">
                            <i class="fas fa-envelope" aria-hidden="true"></i>
                            <span>{{ employee.email or '-' }}</span>
                        </div>
                        <div class="profile-header__meta-item">
                            <i class="fas fa-phone" aria-hidden="true"></i>
                            <span>{{ employee.phone or '-' }}</span>
                        </div>
                        {% endif %}
                        {% endif %}
                    </div>
                    <div class="profile-header__status">
                        {% if is_hr_card_mode %}
                        {% set status_text = get_status_text(employee.status) if get_status_text else (employee.status or 'Active') %}
                        {% set is_active = status_text in ['재직중', 'Active', '재직', 'active'] %}
                        <span class="profile-header__status-dot{% if not is_active %} profile-header__status-dot--warning{% endif %}"></span>
                        {{ status_text }}
                        {% else %}
                        <span class="profile-header__status-dot"></span>
                        Active
                        {% endif %}
                    </div>
                </div>
            </div>
            <!-- 2행: 통계 -->
            <div class="profile-header__row profile-header__row--stats">
                <div class="profile-header__stats">
                    {% if is_hr_card_mode %}
                    {# 인사카드 모드: 고용 정보 #}
                    <div class="profile-header__stat">
                        <div class="profile-header__stat-label">입사일</div>
                        <div class="profile-header__stat-value">{{ employee.hire_date or '-' }}</div>
                    </div>
                    <div class="profile-header__stat">
                        <div class="profile-header__stat-label">재직기간</div>
                        <div class="profile-header__stat-value">{{ calculate_tenure(employee.hire_date) if calculate_tenure and employee.hire_date else '-' }}</div>
                    </div>
                    <div class="profile-header__stat">
                        <div class="profile-header__stat-label">연차 잔여</div>
                        <div class="profile-header__stat-value profile-header__stat-value--accent">{{ employee.remaining_leave|default(15) }}일</div>
                    </div>
                    <div class="profile-header__stat">
                        <div class="profile-header__stat-label">사번</div>
                        <div class="profile-header__stat-value">{{ employee.employee_number or 'EMP-%03d'|format(employee.id) }}</div>
                    </div>
                    {% else %}
                    {# 프로필 모드: 계정 타입별 정보 #}
                    {% if effective_account_type == 'corporate' %}
                    <div class="profile-header__stat">
                        <div class="profile-header__stat-label">직원 수</div>
                        <div class="profile-header__stat-value">{{ employee.employee_count|default(0) }}명</div>
                    </div>
                    <div class="profile-header__stat">
                        <div class="profile-header__stat-label">계약 수</div>
                        <div class="profile-header__stat-value profile-header__stat-value--accent">{{ employee.contract_count|default(0) }}건</div>
                    </div>
                    <div class="profile-header__stat">
                        <div class="profile-header__stat-label">가입일</div>
                        <div class="profile-header__stat-value">{{ employee.created_at|default('-') }}</div>
                    </div>
                    {% else %}
                    <div class="profile-header__stat">
                        <div class="profile-header__stat-label">생년월일</div>
                        <div class="profile-header__stat-value">{{ employee.birth_date or '-' }}</div>
                    </div>
                    <div class="profile-header__stat">
                        <div class="profile-header__stat-label">계약 수</div>
                        <div class="profile-header__stat-value profile-header__stat-value--accent">{{ employee.contract_count|default(0) }}건</div>
                    </div>
                    <div class="profile-header__stat">
                        <div class="profile-header__stat-label">가입일</div>
                        <div class="profile-header__stat-value">{{ employee.created_at|default('-') }}</div>
                    </div>
                    <div class="profile-header__stat">
                        <div class="profile-header__stat-label">회원번호</div>
                        <div class="profile-header__stat-value">USR-{{ '%03d'|format(employee.id) }}</div>
                    </div>
                    {% endif %}
                    {% endif %}
                </div>
            </div>
        </div>

        {% if show_card %}
        <!-- 명함 칼럼 (인사카드 모드 전용) -->
        <div class="profile-header__column profile-header__column--card" data-employee-id="{{ employee.id }}">
            <span class="profile-header__card-label">Business Card</span>
            <div class="profile-header__card-wrapper">
                {# 명함 컴포넌트: 이미지 있으면 이미지 모드, 없으면 템플릿 모드 (auto) #}
                {% set size = 'md' %}
                {% include 'domains/businesscard/partials/_card.html' %}
            </div>
            {% if can_edit_business_card %}
            <div class="profile-header__card-actions">
                <button type="button" class="profile-header__card-btn" data-action="open-business-card-modal">
                    <i class="fas fa-upload" aria-hidden="true"></i> 업로드
                </button>
                {% if business_card_front or business_card_back %}
                <button type="button" class="profile-header__card-btn" data-action="delete-all-business-cards">
                    <i class="fas fa-trash" aria-hidden="true"></i> 삭제
                </button>
                {% endif %}
            </div>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>
