{#
 # Avatar Macro
 # 프로필 이미지 폴백 처리 SSOT (Single Source of Truth)
 #
 # Parameters:
 #   src: 이미지 URL (optional)
 #   alt: 대체 텍스트 (이름)
 #   size: 'xs' | 'sm' | 'md' | 'lg' | 'xl' (default: 'sm')
 #   fallback: 'icon' | 'initial' (default: 'icon')
 #   theme: 'default' | 'personal' | 'corporate' | 'employee' (default: 'default')
 #   extra_class: 추가 CSS 클래스 (optional)
 #
 # Usage:
 #   {% from 'shared/macros/_avatar.html' import avatar_image %}
 #   {{ avatar_image(employee.photo, employee.name, size='sm') }}
 #   {{ avatar_image(profile.photo, profile.name, size='md', fallback='initial', theme='personal') }}
 #}

{% macro avatar_image(src, alt, size='sm', fallback='icon', theme='default', extra_class='') %}
<div class="avatar avatar--{{ size }}{% if extra_class %} {{ extra_class }}{% endif %}">
    {% if src %}
    <img src="{{ src }}"
         alt="{{ alt }}"
         class="avatar__image"
         data-fallback-type="{{ fallback }}"
         data-fallback-theme="{{ theme }}"
         data-fallback-initial="{{ alt[:1]|upper if alt else '?' }}">
    {% endif %}
    <div class="avatar-fallback{% if src %} avatar-fallback--hidden{% endif %}{% if fallback == 'initial' %} avatar-placeholder avatar-placeholder--{{ theme }}{% else %} avatar-icon-placeholder{% endif %}">
        {% if fallback == 'initial' %}
        {{ alt[:1]|upper if alt else '?' }}
        {% else %}
        <i class="fas fa-user" aria-hidden="true"></i>
        {% endif %}
    </div>
</div>
{% endmacro %}
