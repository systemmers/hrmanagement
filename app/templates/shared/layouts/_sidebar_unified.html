{#
    통합 사이드바 템플릿
    - account_type과 role 기반 동적 메뉴 생성
    - 개인(personal), 법인 직원(employee), 법인 관리자(corporate) 통합
    - 플랫폼 관리자(superadmin) 전용 메뉴 포함
    Phase 3: 템플릿 통합 작업
    Phase 4: 사이드바 검색 컴포넌트 추가 (2026-01-11)
    Phase 5: 직원 프로필 카드 추가 (2026-01-11)
#}

{# ========================================
   검색 컴포넌트와 직원 프로필 카드는 직원 관리 섹션으로 이동됨 (2026-01-12)
   ======================================== #}

{# ========================================
   플랫폼 관리자 (Superadmin) 메뉴
   ======================================== #}
{% if session.get('is_superadmin') %}

<!-- 플랫폼 관리 섹션 -->
<div class="nav-section platform-admin-section">
    <h2 class="nav-section-title">
        <i class="fas fa-crown"></i> 플랫폼 관리
    </h2>
    <a href="{{ url_for('platform.dashboard') }}"
       class="nav-item {% if request.endpoint == 'platform.dashboard' %}active{% endif %}">
        <i class="fas fa-tachometer-alt"></i>
        <span>대시보드</span>
    </a>
    <a href="{{ url_for('platform.companies_list') }}"
       class="nav-item {% if request.endpoint and request.endpoint.startswith('platform.compan') %}active{% endif %}">
        <i class="fas fa-building"></i>
        <span>법인 관리</span>
    </a>
    <a href="{{ url_for('platform.users_list') }}"
       class="nav-item {% if request.endpoint and request.endpoint.startswith('platform.user') %}active{% endif %}">
        <i class="fas fa-users"></i>
        <span>사용자 관리</span>
    </a>
    <a href="{{ url_for('platform.settings_list') }}"
       class="nav-item {% if request.endpoint == 'platform.settings_list' %}active{% endif %}">
        <i class="fas fa-cog"></i>
        <span>시스템 설정</span>
    </a>
</div>

{# ========================================
   개인 계정 (Personal) 메뉴
   ======================================== #}
{% elif current_user and current_user.account_type == 'personal' %}

<!-- 내 정보 섹션 -->
<div class="nav-section">
    <h2 class="nav-section-title">내 정보</h2>
    <a href="{{ url_for('personal.dashboard') }}"
       class="nav-item {% if request.endpoint == 'personal.dashboard' %}active{% endif %}">
        <i class="fas fa-tachometer-alt"></i>
        <span>대시보드</span>
    </a>
    <a href="{{ url_for('personal.profile') }}"
       class="nav-item {% if request.endpoint == 'personal.profile' or request.endpoint == 'personal.profile_edit' %}active{% endif %}">
        <i class="fas fa-user"></i>
        <span>프로필</span>
    </a>
</div>

<!-- 회사 인사카드 섹션 (개인) - Phase 3 신규 -->
<div class="nav-section">
    <h2 class="nav-section-title">회사 인사카드</h2>
    <a href="{{ url_for('personal.company_card_list') }}"
       class="nav-item {% if 'company_card' in (request.endpoint or '') %}active{% endif %}">
        <i class="fas fa-building"></i>
        <span>인사카드 목록</span>
    </a>
</div>

<!-- 계약 관리 섹션 (개인) -->
<div class="nav-section">
    <h2 class="nav-section-title">계약 관리</h2>
    <a href="{{ url_for('contracts.my_contracts') }}"
       class="nav-item {% if request.endpoint == 'contracts.my_contracts' %}active{% endif %}">
        <i class="fas fa-file-contract"></i>
        <span>내 계약</span>
    </a>
    <a href="{{ url_for('contracts.pending_contracts') }}"
       class="nav-item {% if request.endpoint == 'contracts.pending_contracts' %}active{% endif %}">
        <i class="fas fa-clock"></i>
        <span>대기 중인 요청</span>
    </a>
</div>

<!-- 계정 관리 섹션 (개인) - Phase 3 신규 -->
<div class="nav-section">
    <h2 class="nav-section-title">계정 관리</h2>
    <a href="{{ url_for('account.settings') }}"
       class="nav-item {% if request.endpoint == 'account.settings' %}active{% endif %}">
        <i class="fas fa-cog"></i>
        <span>계정 설정</span>
    </a>
    <a href="{{ url_for('account.privacy') }}"
       class="nav-item {% if request.endpoint == 'account.privacy' %}active{% endif %}">
        <i class="fas fa-user-shield"></i>
        <span>공개 설정</span>
    </a>
</div>

{# ========================================
   법인 직원 (Employee Sub) 메뉴
   ======================================== #}
{% elif current_user and current_user.role == 'employee' and current_user.employee_id %}

<!-- 내 정보 섹션 (통합) -->
<div class="nav-section">
    <h2 class="nav-section-title">내 정보</h2>
    <a href="{{ url_for('profile.dashboard') }}"
       class="nav-item {% if request.endpoint == 'profile.dashboard' %}active{% endif %}">
        <i class="fas fa-tachometer-alt"></i>
        <span>대시보드</span>
    </a>
    <a href="{{ url_for('profile.view') }}"
       class="nav-item {% if request.endpoint == 'profile.view' or request.endpoint == 'profile.edit' %}active{% endif %}">
        <i class="fas fa-user"></i>
        <span>프로필</span>
    </a>
</div>

<!-- 회사정보 섹션 -->
<div class="nav-section">
    <h2 class="nav-section-title">회사정보</h2>
    <a href="{{ url_for('mypage.company_info') }}"
       class="nav-item {% if request.endpoint == 'mypage.company_info' %}active{% endif %}">
        <i class="fas fa-building"></i>
        <span>회사 인사카드</span>
    </a>
</div>

<!-- 계약 관리 섹션 (직원) -->
<div class="nav-section">
    <h2 class="nav-section-title">계약 관리</h2>
    <a href="{{ url_for('contracts.my_contracts') }}"
       class="nav-item {% if request.endpoint == 'contracts.my_contracts' %}active{% endif %}">
        <i class="fas fa-file-contract"></i>
        <span>내 계약</span>
    </a>
    <a href="{{ url_for('contracts.pending_contracts') }}"
       class="nav-item {% if request.endpoint == 'contracts.pending_contracts' %}active{% endif %}">
        <i class="fas fa-clock"></i>
        <span>대기 중인 요청</span>
    </a>
</div>

<!-- 계정관리 섹션 (확장) -->
<div class="nav-section">
    <h2 class="nav-section-title">계정 관리</h2>
    <a href="{{ url_for('account.settings') }}"
       class="nav-item {% if request.endpoint == 'account.settings' %}active{% endif %}">
        <i class="fas fa-cog"></i>
        <span>계정 설정</span>
    </a>
    <a href="{{ url_for('account.privacy') }}"
       class="nav-item {% if request.endpoint == 'account.privacy' %}active{% endif %}">
        <i class="fas fa-user-shield"></i>
        <span>공개 설정</span>
    </a>
</div>

{# ========================================
   법인 관리자/매니저 (Corporate Admin) 메뉴
   ======================================== #}
{% else %}

<!-- 대시보드 섹션 -->
<div class="nav-section">
    <h2 class="nav-section-title">대시보드</h2>
    <a href="{{ url_for('main.index') }}" class="nav-item {% if request.endpoint == 'main.index' %}active{% endif %}">
        <i class="fas fa-tachometer-alt"></i>
        <span>직원 현황</span>
    </a>
</div>

<!-- 직원 관리 섹션 -->
<div class="nav-section">
    <h2 class="nav-section-title">직원 관리</h2>

    {# 검색 컴포넌트 - 직원 관리 섹션 내부 (2026-01-12 이동) #}
    <div class="sidebar-search">
        <svg class="sidebar-search__icon" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"/>
        </svg>
        <input type="text" class="sidebar-search__input"
               placeholder="직원 검색..."
               aria-label="직원 검색">
        <button type="button" class="sidebar-search__clear" aria-label="검색어 지우기">
            <i class="fas fa-times"></i>
        </button>
        <button type="button" class="sidebar-search__btn" aria-label="검색">
            <i class="fas fa-search"></i>
        </button>
    </div>

    {# 직원 프로필 카드 (직원 상세/수정 페이지에서만) #}
    {% if employee and request.endpoint in ['employees.employee_detail', 'employees.employee_edit'] %}
    {% include 'shared/partials/_employee_card_nav.html' %}
    {% endif %}

    <a href="{{ url_for('employees.employee_list') }}" class="nav-item {% if request.endpoint == 'employees.employee_list' %}active{% endif %}">
        <i class="fas fa-users"></i>
        <span>직원 목록</span>
    </a>
    <a href="{{ url_for('employees.employee_new') }}" class="nav-item {% if request.endpoint == 'employees.employee_new' %}active{% endif %}">
        <i class="fas fa-user-plus"></i>
        <span>직원 등록</span>
    </a>
    {# 계정 발급은 직원 목록/등록 페이지의 버튼 또는 계정관리 페이지에서 접근 가능 #}
</div>

<!-- 계약 관리 섹션 (법인) -->
{% if current_user and current_user.account_type == 'corporate' %}
<div class="nav-section">
    <h2 class="nav-section-title">계약 관리</h2>
    <a href="{{ url_for('contracts.company_contracts') }}"
       class="nav-item {% if request.endpoint == 'contracts.company_contracts' %}active{% endif %}">
        <i class="fas fa-file-contract"></i>
        <span>계약 목록</span>
    </a>
    <a href="#"
       class="nav-item">
        <i class="fas fa-cogs"></i>
        <span>계약 설정 : 준비중</span>
    </a>
    {# 계약 요청, 대기 중 메뉴는 계약 목록 페이지의 모달/필터로 통합됨 #}
</div>
{% endif %}

<!-- 법인 관리 섹션 (관리자 전용) -->
{% if current_user and current_user.is_admin %}
<div class="nav-section">
    <h2 class="nav-section-title">법인 관리</h2>
    <a href="{{ url_for('corporate.dashboard') }}" class="nav-item {% if request.endpoint == 'corporate.dashboard' %}active{% endif %}">
        <i class="fas fa-building"></i>
        <span>법인 대시보드</span>
    </a>
    <a href="{{ url_for('profile.view') }}" class="nav-item {% if request.endpoint and request.endpoint.startswith('profile.') %}active{% endif %}">
        <i class="fas fa-user-tie"></i>
        <span>관리자 프로필</span>
    </a>
    <a href="{{ url_for('corporate.settings') }}" class="nav-item {% if request.endpoint == 'corporate.settings' %}active{% endif %}">
        <i class="fas fa-building"></i>
        <span>법인 설정</span>
    </a>
    <a href="{{ url_for('corporate.users') }}" class="nav-item {% if request.endpoint == 'corporate.users' %}active{% endif %}">
        <i class="fas fa-users-cog"></i>
        <span>계정 관리</span>
    </a>
</div>
{% endif %}

<!-- AI 테스트 섹션 (프로토타입) -->
<div class="nav-section">
    <h2 class="nav-section-title">
        <i class="fas fa-flask"></i> AI 테스트
    </h2>
    <a href="{{ url_for('ai_test.index') }}" class="nav-item {% if request.endpoint and request.endpoint.startswith('ai_test.') and request.endpoint != 'ai_test.settings' %}active{% endif %}">
        <i class="fas fa-robot"></i>
        <span>문서 분석 테스트</span>
    </a>
    <a href="{{ url_for('ai_test.settings') }}" class="nav-item {% if request.endpoint == 'ai_test.settings' %}active{% endif %}">
        <i class="fas fa-sliders-h"></i>
        <span>AI 설정</span>
    </a>
    <a href="{{ url_for('main.data_table_demo') }}" class="nav-item {% if request.endpoint == 'main.data_table_demo' %}active{% endif %}">
        <i class="fas fa-table"></i>
        <span>데이터 테이블 데모</span>
    </a>
    <a href="{{ url_for('main.styleguide') }}" class="nav-item {% if request.endpoint == 'main.styleguide' %}active{% endif %}">
        <i class="fas fa-palette"></i>
        <span>스타일 가이드</span>
    </a>
</div>

{% endif %}
