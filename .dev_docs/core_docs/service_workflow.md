# 서비스 프로세스 워크플로우

프로젝트: HR Management System
작성일: 2025-12-16

---

## 목차
1. [플랫폼 개요](#플랫폼-개요)
2. [계정 체계](#계정-체계)
3. [회원가입 프로세스](#회원가입-프로세스)
4. [로그인/인증 프로세스](#로그인인증-프로세스)
5. [직원 등록 프로세스](#직원-등록-프로세스)
6. [계약 체결 프로세스](#계약-체결-프로세스)
7. [데이터 동기화 프로세스](#데이터-동기화-프로세스)
8. [프로필 관리 프로세스](#프로필-관리-프로세스)
9. [조직 관리 프로세스](#조직-관리-프로세스)
10. [알림 시스템](#알림-시스템)

---

## 플랫폼 개요

```
+------------------------------------------------------------------+
|                        HR Management Platform                      |
+------------------------------------------------------------------+
|                                                                    |
|  +------------------+    +------------------+    +---------------+ |
|  |   개인 계정       |    |   법인 계정       |    |  직원 계정    | |
|  |   (Personal)     |<-->|   (Corporate)    |<-->| (Employee_sub)| |
|  +------------------+    +------------------+    +---------------+ |
|         |                       |                      |          |
|         |    [계약 관계]         |    [소속 관계]        |          |
|         +--------->-------------+----------<-----------+          |
|                                                                    |
+------------------------------------------------------------------+
```

### 핵심 기능
- 멀티테넌시 기반 법인별 독립 관리
- 개인-법인 간 계약 기반 데이터 공유
- 통합 프로필 시스템 (개인/법인 UI 통합)
- AI 기반 문서 처리 (OCR, 자동 분석)

---

## 계정 체계

### 계정 유형별 정의

| 계정 유형 | 설명 | 생성 주체 | 주요 기능 |
|-----------|------|----------|----------|
| personal | 독립 개인 계정 | 본인 | 프로필 관리, 계약 수락/거절 |
| corporate | 법인 관리자 계정 | 본인 (법인 등록) | 직원 관리, 계약 요청, 조직 관리 |
| employee_sub | 법인 소속 직원 계정 | 법인 관리자 | 프로필 입력, 계약 수락 |

### 계정 관계도

```
[플랫폼]
    |
    +-- [개인계정 (personal)]
    |       |
    |       +-- 계약 --> [법인 A]
    |       +-- 계약 --> [법인 B]
    |
    +-- [법인계정 (corporate)]
            |
            +-- Company (법인 정보)
            |       |
            |       +-- Organization (조직도)
            |
            +-- [직원계정 (employee_sub)]
                    |
                    +-- emp_a1, emp_a2, ... (하위 계정)
```

---

## 회원가입 프로세스

### 1. 개인 회원가입

```
[시작] --> [회원가입 유형 선택] --> [개인 선택]
                                        |
                                        v
                              [개인정보 입력 폼]
                              - 이메일 (계정 ID)
                              - 비밀번호
                              - 이름
                              - 연락처
                                        |
                                        v
                              [이메일 인증] (선택적)
                                        |
                                        v
                              [계정 생성 완료]
                                        |
                                        v
                              [개인 프로필 입력]
                              - 기본정보
                              - 학력/경력
                              - 자격증
                                        |
                                        v
                                    [완료]
```

**엔드포인트**: `/personal/register`

### 2. 법인 회원가입

```
[시작] --> [회원가입 유형 선택] --> [법인 선택]
                                        |
                                        v
                              [법인정보 입력 폼]
                              - 상호명
                              - 사업자등록번호
                              - 대표자명
                              - 업종/업태
                              - 주소
                                        |
                                        v
                              [관리자 계정 생성]
                              - 이메일 (계정 ID)
                              - 비밀번호
                              - 담당자명
                                        |
                                        v
                              [사업자등록증 인증] (선택적)
                                        |
                                        v
                              [계정 생성 완료]
                                        |
                                        v
                              [조직 구조 설정]
                              - 부서/팀 구성
                              - 직급 체계
                                        |
                                        v
                                    [완료]
```

**엔드포인트**: `/corporate/register`

---

## 로그인/인증 프로세스

### 로그인 플로우

```
[로그인 페이지] --> [이메일/비밀번호 입력]
                            |
                            v
                   [인증 확인]
                   user_repo.authenticate()
                            |
              +-------------+-------------+
              |                           |
         [실패]                       [성공]
              |                           |
              v                           v
    [에러 메시지 표시]            [세션 생성]
    - 잘못된 자격 증명            - user_id
                                  - username
                                  - user_role
                                  - account_type
                                  - company_id
                                  - employee_id
                                        |
                                        v
                               [계정 유형별 리다이렉트]
                               - personal  --> /profile/edit
                               - corporate --> /corporate/dashboard
                               - employee_sub --> /profile/edit
```

**엔드포인트**: `/auth/login`

### 세션 구조

```python
session = {
    'user_id': int,           # 사용자 ID
    'username': str,          # 사용자명
    'user_role': str,         # 권한 (admin/manager/employee)
    'account_type': str,      # 계정 유형 (personal/corporate/employee_sub)
    'company_id': int,        # 소속 법인 ID (법인 계정만)
    'employee_id': int,       # 직원 ID (연결된 경우)
    'personal_profile_id': int # 개인 프로필 ID (개인 계정만)
}
```

---

## 직원 등록 프로세스

### 법인 관리자의 직원 등록

```
[법인 대시보드] --> [직원 등록 메뉴]
                            |
                            v
                   +--------+--------+
                   |                 |
            [방법 1]             [방법 2]
         계정+정보 등록        계정만 등록
                   |                 |
                   v                 v
        [직원 등록 폼]        [계정 생성 폼]
        - 계정정보             - 이메일
          - 이메일             - 초기 비밀번호
          - 초기 비밀번호
        - 기본정보                  |
          - 이름, 연락처            v
          - 주소 등           [계정 생성]
        - 소속정보            (employee_sub)
          - 부서/팀                 |
          - 직급/직책               v
          - 입사일            [직원 로그인]
                                    |
                   |                v
                   v          [정보 입력]
           [Employee 생성]    (본인이 직접)
           [User 생성]              |
           (employee_sub)           v
                   |          [정보 저장]
                   v                |
           [계약 요청]         <----+
           (자동 또는 수동)
                   |
                   v
           [계약 승인 대기]
                   |
                   v
           [직원 목록 표시]
           (계약 승인 후)
```

**엔드포인트**:
- `/employees/new` - 직원 등록 폼
- `/corporate/add-user` - 계정만 생성

### 직원 등록 상태 변화

```
[계정 생성] --> [사용자 목록 표시]
                      |
                      v (정보 입력 완료)
              [계약 요청 발송]
                      |
                      v
              [계약 대기 상태]
              - 직원 목록: 미표시
              - 계약 목록: 대기 중
                      |
                      v (계약 승인)
              [계약 활성화]
              - 직원 목록: 표시
              - 계약 목록: 활성
                      |
                      v
              [관리 대상 포함]
```

---

## 계약 체결 프로세스

### 1. 법인 -> 개인 계약 요청

```
[법인 관리자]
      |
      v
[계약 요청 페이지]
- 개인 이메일 검색
- 계약 유형 선택
- 직책/부서 지정
- 비고 입력
      |
      v
[계약 요청 전송]
contract_service.create_contract_request()
      |
      v
[PersonCorporateContract 생성]
- status: 'pending'
- requested_by: 'company'
      |
      v
[개인에게 알림 발송]
      |
      v
[개인 계약 대기 목록에 표시]
```

**엔드포인트**: `/contracts/request`

### 2. 개인/직원의 계약 승인/거절

```
[개인/직원 계정]
      |
      v
[대기 중인 계약 목록]
/contracts/pending
      |
      v
[계약 상세 확인]
- 요청 법인 정보
- 계약 조건
- 데이터 공유 설정
      |
      +-------+-------+
      |               |
  [승인]           [거절]
      |               |
      v               v
[api_approve]   [api_reject]
      |               |
      v               v
[상태: active]  [상태: rejected]
      |               |
      v               v
[직원 목록 추가] [계약 종료]
[데이터 동기화]
```

**엔드포인트**:
- `/contracts/api/<id>/approve`
- `/contracts/api/<id>/reject`

### 3. 계약 상태 흐름

```
                    +-- [rejected] --> (종료)
                    |
[pending] --> [승인/거절 선택]
                    |
                    +-- [active] --> [terminated] --> (종료)
                              |
                              +-- (계약 갱신) --> [active]
```

### 계약 상태 정의

| 상태 | 설명 | 직원 목록 | 데이터 동기화 |
|------|------|----------|--------------|
| pending | 요청 대기 | 미표시 | 불가 |
| active | 계약 활성 | 표시 | 가능 |
| rejected | 거절됨 | 미표시 | 불가 |
| terminated | 계약 종료 | 미표시 | 불가 |

---

## 데이터 동기화 프로세스

### 동기화 개념

```
[개인 프로필 (PersonalProfile)]
         |
         | 계약 승인 시
         v
[데이터 공유 설정 (DataSharingSettings)]
         |
         | 허용된 필드만
         v
[법인 직원 정보 (Employee)]
```

### 동기화 플로우

```
[개인 정보 변경]
      |
      v
[변경 감지]
event_listeners.py
      |
      v
[활성 계약 확인]
      |
      +-- 계약 없음 --> (종료)
      |
      v
[공유 설정 확인]
DataSharingSettings
      |
      v
[허용된 필드 추출]
- share_basic_info
- share_education
- share_career
- share_certificates
      |
      v
[Employee 정보 업데이트]
sync_service.sync_to_employee()
      |
      v
[SyncLog 기록]
```

### 공유 설정 항목

| 설정 항목 | 설명 | 기본값 |
|-----------|------|--------|
| share_basic_info | 기본정보 공유 | True |
| share_education | 학력정보 공유 | False |
| share_career | 경력정보 공유 | False |
| share_certificates | 자격증 공유 | False |
| share_family | 가족정보 공유 | False |
| share_military | 병역정보 공유 | False |

---

## 프로필 관리 프로세스

### 통합 프로필 구조

```
[프로필 메인]
      |
      +-- [기본정보 섹션]
      |   - 사진
      |   - 인적사항
      |   - 연락처
      |   - 주소
      |
      +-- [이력정보 섹션]
      |   - 학력
      |   - 경력
      |   - 자격증
      |   - 어학
      |   - 병역
      |
      +-- [계약정보 섹션] (개인/직원)
      |   - 계약 목록
      |   - 회사 인사카드
      |
      +-- [HR 정보 섹션] (법인 직원)
      |   - 급여정보
      |   - 근태정보
      |   - 평가정보
      |
      +-- [계정설정 섹션]
          - 비밀번호 변경
          - 공개 설정
          - 알림 설정
```

### 프로필 수정 플로우

```
[프로필 편집]
      |
      v
[섹션 선택]
- 사이드바 네비게이션
      |
      v
[폼 데이터 입력]
      |
      v
[유효성 검증]
- 클라이언트: validators.js
- 서버: form_extractors.py
      |
      v
[저장 요청]
      |
      +-- 개인계정 --> PersonalProfile 저장
      |
      +-- 법인직원 --> Employee 저장
                             |
                             v
                    [동기화 트리거]
                    (역방향 동기화)
```

---

## 조직 관리 프로세스

### 조직 구조

```
[Company (법인)]
      |
      +-- [Organization (조직)]
              |
              +-- 본부 (company)
                    |
                    +-- 사업부 (division)
                          |
                          +-- 부서 (department)
                                |
                                +-- 팀 (team)
                                      |
                                      +-- 파트 (unit)
```

### 조직 관리 플로우

```
[조직 관리 페이지]
/admin/organization
      |
      v
[트리 구조 표시]
      |
      +-- [조직 추가]
      |   - 상위 조직 선택
      |   - 조직명 입력
      |   - 조직 유형 선택
      |
      +-- [조직 수정]
      |   - 조직명 변경
      |   - 상위 조직 변경
      |
      +-- [조직 삭제]
      |   - 하위 조직 처리
      |   - 소속 직원 처리
      |
      +-- [직원 배치]
          - 드래그 앤 드롭
          - 소속 변경
```

---

## 알림 시스템

### 알림 유형

| 유형 | 트리거 | 수신자 |
|------|--------|--------|
| contract_request | 계약 요청 발송 | 개인/직원 |
| contract_approved | 계약 승인 | 법인 관리자 |
| contract_rejected | 계약 거절 | 법인 관리자 |
| contract_terminated | 계약 종료 | 양측 |
| sync_completed | 동기화 완료 | 법인 관리자 |
| profile_updated | 프로필 변경 | 관련 법인 |

### 알림 플로우

```
[이벤트 발생]
      |
      v
[알림 생성]
notification_service.create_notification()
      |
      v
[Notification 저장]
      |
      v
[실시간 알림] (향후)
      |
      v
[알림 목록 표시]
- 드롭다운 메뉴
- 읽음/안읽음 상태
```

---

## 부록: 주요 서비스 흐름도

### 전체 서비스 플로우

```
+------------------------------------------------------------------+
|                         사용자 여정                                |
+------------------------------------------------------------------+
|                                                                    |
|  [회원가입] --> [로그인] --> [프로필 설정] --> [서비스 이용]        |
|                                                                    |
|  개인:                                                             |
|  가입 --> 프로필 입력 --> 계약 수락 --> 회사 인사카드 조회          |
|                                                                    |
|  법인:                                                             |
|  가입 --> 조직 설정 --> 직원 등록 --> 계약 요청 --> 직원 관리       |
|                                                                    |
|  직원:                                                             |
|  계정 수신 --> 로그인 --> 정보 입력 --> 계약 승인 --> 서비스 이용   |
|                                                                    |
+------------------------------------------------------------------+
```

### 데이터 흐름도

```
[Frontend]                    [Backend]                    [Database]
    |                             |                            |
    | HTTP Request                |                            |
    |------------------------->   |                            |
    |                             |                            |
    |                      [Blueprint]                         |
    |                             |                            |
    |                      [Decorator]                         |
    |                      (인증/권한)                          |
    |                             |                            |
    |                      [Service]                           |
    |                      (비즈니스 로직)                       |
    |                             |                            |
    |                      [Repository]                        |
    |                             |                            |
    |                             |    Query                   |
    |                             |----------------------->    |
    |                             |                            |
    |                             |    Result                  |
    |                             |<-----------------------    |
    |                             |                            |
    |                      [Response]                          |
    |<----------------------      |                            |
    |                             |                            |
```

---

## 변경 이력

| 날짜 | 버전 | 변경 내용 |
|------|------|----------|
| 2025-12-16 | 1.0 | 초기 작성 |
